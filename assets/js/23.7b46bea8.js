(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{414:function(t,s,a){"use strict";a.r(s);var n=a(54),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[t._v("#")]),t._v(" 简介")]),t._v(" "),a("h3",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[t._v("#")]),t._v(" 安装")]),t._v(" "),a("h2",{attrs:{id:"镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#镜像"}},[t._v("#")]),t._v(" 镜像")]),t._v(" "),a("h3",{attrs:{id:"获取镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#获取镜像"}},[t._v("#")]),t._v(" 获取镜像")]),t._v(" "),a("p",[a("code",[t._v("docker pull [选项] [Docker Registry 地址[:端口号]/]仓库名[:标签]")])]),t._v(" "),a("ul",[a("li",[t._v("Docker 镜像仓库地址：地址的格式一般是 "),a("code",[t._v("<域名/IP>[:端口号]")]),t._v("。默认地址是 Docker Hub")]),t._v(" "),a("li",[t._v("仓库名：如之前所说，这里的仓库名是两段式名称，即 "),a("code",[t._v("<用户名>/<软件名>")]),t._v("。对于 Docker Hub，如果不给出用户名，则默认为 "),a("code",[t._v("library")]),t._v("，也就是官方镜像。")])]),t._v(" "),a("ol",[a("li",[t._v("从官方仓库获取镜像")])]),t._v(" "),a("p",[a("code",[t._v("$ docker pull ubuntu:18.04")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[t._v("18.04")]),t._v(": Pulling from library/ubuntu\nbf5d46315322: Pull complete\n9f13e0ac480c: Pull complete\ne8988b5b3097: Pull complete\n40af181810e7: Pull complete\ne6f7c7e5c03e: Pull complete\nDigest: sha256:147913621d9cdea08853f6ba9116c2e27a3ceffecf3b492983ae97c3d643fbbe\nStatus: Downloaded newer image "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" ubuntu:18.04\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("从私有仓库获取镜像")])]),t._v(" "),a("p",[a("code",[t._v("$ docker pull sc.yhub.ysten.com:9881/sichuan/vas/yst-vas-batch:1.0.0130_sichuan")])]),t._v(" "),a("h3",{attrs:{id:"运行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#运行"}},[t._v("#")]),t._v(" 运行")]),t._v(" "),a("p",[t._v("有了镜像后，我们就能够以这个镜像为基础启动并运行一个容器。")]),t._v(" "),a("p",[a("code",[t._v("$ docker run -it --rm ubuntu:18.04 bash")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("root@d786d31cbd76:/"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cat /etc/os-release")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("NAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Ubuntu"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("VERSION")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"18.04.2 LTS (Bionic Beaver)"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ID")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ubuntu\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ID_LIKE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("debian\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("PRETTY_NAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Ubuntu 18.04.2 LTS"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("VERSION_ID")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"18.04"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("HOME_URL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://www.ubuntu.com/"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("SUPPORT_URL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://help.ubuntu.com/"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("BUG_REPORT_URL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://bugs.launchpad.net/ubuntu/"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("PRIVACY_POLICY_URL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://www.ubuntu.com/legal/terms-and-policies/privacy-policy"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("VERSION_CODENAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("bionic\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("UBUNTU_CODENAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("bionic\n")])])]),a("h3",{attrs:{id:"列出镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#列出镜像"}},[t._v("#")]),t._v(" 列出镜像")]),t._v(" "),a("p",[a("code",[t._v("$ docker image ls")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker image ls")]),t._v("\nREPOSITORY           TAG                 IMAGE ID            CREATED             SIZE\nredis                latest              5f515359c7f8        "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" days ago          "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("183")]),t._v(" MB\nnginx                latest              05a60462f8ba        "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" days ago          "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("181")]),t._v(" MB\nmongo                "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.2")]),t._v("                 fe9198c04d62        "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" days ago          "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("342")]),t._v(" MB\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("               "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("              00285df0df87        "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" days ago          "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("342")]),t._v(" MB\nubuntu               "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("18.04")]),t._v("               f753707788c5        "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" weeks ago         "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127")]),t._v(" MB\nubuntu               latest              f753707788c5        "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" weeks ago         "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127")]),t._v(" MB\n")])])]),a("p",[t._v("列表包含了 "),a("code",[t._v("仓库名")]),t._v("、"),a("code",[t._v("标签")]),t._v("、"),a("code",[t._v("镜像ID")]),t._v("、"),a("code",[t._v("创建时间")]),t._v("以及"),a("code",[t._v("所占用的空间")]),t._v("。"),a("strong",[t._v("镜像 ID")]),t._v(" 则是镜像的唯一标识，一个镜像可以对应多个"),a("strong",[t._v("标签")])]),t._v(" "),a("h3",{attrs:{id:"虚悬镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#虚悬镜像"}},[t._v("#")]),t._v(" 虚悬镜像")]),t._v(" "),a("p",[a("code",[t._v("docker image ls -f dangling=true")])]),t._v(" "),a("p",[t._v("一般来说，虚悬镜像已经失去了存在的价值，是可以随意删除的，可以用上面的命令删除。")]),t._v(" "),a("h3",{attrs:{id:"镜像构建最小化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#镜像构建最小化"}},[t._v("#")]),t._v(" 镜像构建最小化")]),t._v(" "),a("ol",[a("li",[t._v("减少镜像层")])]),t._v(" "),a("p",[a("code",[t._v("错误示例")])]),t._v(" "),a("div",{staticClass:"language-Dockerfile extra-class"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" ubuntu")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" apt-get update")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" apt-get install vim")]),t._v("\n")])])]),a("p",[a("code",[t._v("正确示例")])]),t._v(" "),a("div",{staticClass:"language-Dockerfile extra-class"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" ubuntu")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" apt-get update && apt-get install vim")]),t._v("\n")])])]),a("p",[t._v("2.删掉容器中所有不必要的东西")]),t._v(" "),a("p",[t._v("3.基于Alpine的较小基础镜像")]),t._v(" "),a("h2",{attrs:{id:"网络"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#网络"}},[t._v("#")]),t._v(" 网络")]),t._v(" "),a("h3",{attrs:{id:"bridge网络模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#bridge网络模式"}},[t._v("#")]),t._v(" Bridge网络模式")]),t._v(" "),a("h3",{attrs:{id:"host网络模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#host网络模式"}},[t._v("#")]),t._v(" Host网络模式")]),t._v(" "),a("h3",{attrs:{id:"container网络模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#container网络模式"}},[t._v("#")]),t._v(" Container网络模式")]),t._v(" "),a("h3",{attrs:{id:"none网络模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#none网络模式"}},[t._v("#")]),t._v(" None网络模式")]),t._v(" "),a("h2",{attrs:{id:"dockerfile"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile"}},[t._v("#")]),t._v(" Dockerfile")]),t._v(" "),a("h3",{attrs:{id:"概述"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[t._v("#")]),t._v(" 概述")]),t._v(" "),a("p",[t._v("镜像的定制实际上就是定制每一层所添加的配置、文件。如果我们可以把每一层修改、安装、构建、操作的命令都写入一个脚本，用这个脚本来构建、定制镜像，这个脚本就是 Dockerfile。")]),t._v(" "),a("p",[t._v("Dockerfile 是一个文本文件，其内包含了一条条的"),a("strong",[t._v("指令(Instruction)")]),t._v("，每一条指令构建一层，因此每一条指令的内容，就是描述该层应当如何构建。")]),t._v(" "),a("div",{staticClass:"language-dockerfile extra-class"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" nginx")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" echo "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<h1>Hello, Docker!</h1>'")]),t._v(" > /usr/share/nginx/html/index.html")]),t._v("\n")])])]),a("h3",{attrs:{id:"from"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#from"}},[t._v("#")]),t._v(" FROM")]),t._v(" "),a("div",{staticClass:"language-dockerfile extra-class"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" scratch")]),t._v("\n")])])]),a("h3",{attrs:{id:"build"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#build"}},[t._v("#")]),t._v(" BUILD")]),t._v(" "),a("p",[a("code",[t._v("build")]),t._v("指令用来构建镜像")]),t._v(" "),a("p",[t._v("格式：")]),t._v(" "),a("p",[a("code",[t._v("docker build [选项] <上下文路径/URL/->")])]),t._v(" "),a("p",[t._v("在 "),a("code",[t._v("Dockerfile")]),t._v(" 文件所在目录执行：")]),t._v(" "),a("p",[a("code",[t._v("$ docker build -t nginx:v3 .")])]),t._v(" "),a("h3",{attrs:{id:"copy"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#copy"}},[t._v("#")]),t._v(" COPY")]),t._v(" "),a("p",[t._v("COPY有2种格式：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("COPY [--chown=<user>:<group>] <src>... <dest>")])]),t._v(" "),a("li",[a("code",[t._v('COPY [--chown=<user>:<group>] ["<src>",... "<dest>"]')])])]),t._v(" "),a("p",[a("code",[t._v("COPY")]),t._v("指令将从构建上下文目录中"),a("code",[t._v("<源路径>")]),t._v("的文件/目录复制到新的一层的镜像内的"),a("code",[t._v("<目标路径>")]),t._v("位置")]),t._v(" "),a("div",{staticClass:"language-Dockerfile extra-class"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COPY")]),t._v(" package.json /usr/src/app/")]),t._v("\n")])])]),a("h3",{attrs:{id:"add"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#add"}},[t._v("#")]),t._v(" ADD")]),t._v(" "),a("p",[a("code",[t._v("ADD")]),t._v("指令和"),a("code",[t._v("COPY")]),t._v("的格式和性质基本一致，但是在"),a("code",[t._v("COPY")]),t._v("基础上增加了一些功能。")]),t._v(" "),a("ol",[a("li",[a("code",[t._v("ADD")]),t._v("指令支持使用URL作为"),a("code",[t._v("<源路径>")]),t._v("参数")])]),t._v(" "),a("div",{staticClass:"language-Dockerfile extra-class"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ADD")]),t._v(" http://foo.com/bar.go /tmp/")]),t._v("\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[a("code",[t._v("ADD")]),t._v("指令能够自动解压缩文件")])]),t._v(" "),a("div",{staticClass:"language-Dockerfile extra-class"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ADD")]),t._v(" foo.tar.gz /tmp/")]),t._v("\n")])])]),a("p",[t._v("PS: "),a("code",[t._v("COPY")]),t._v("和"),a("code",[t._v("ADD")]),t._v("指令中选择的时候，可以遵循这样的原则，所有的文件复制均使用"),a("code",[t._v("COPY")]),t._v("指令，仅在需要自动解压缩的场合使用"),a("code",[t._v("ADD")]),t._v("。")]),t._v(" "),a("h3",{attrs:{id:"run"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#run"}},[t._v("#")]),t._v(" RUN")]),t._v(" "),a("p",[a("code",[t._v("RUN")]),t._v("指令执行命令并创建新的镜像层，通常用于安装软件包。有2种运行命令的格式")]),t._v(" "),a("ul",[a("li",[t._v("shell格式："),a("code",[t._v("RUN <命令>")]),t._v("，就像直接在命令行中输入的命令一样。")])]),t._v(" "),a("div",{staticClass:"language-Dockerfile extra-class"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" echo hello world")]),t._v("\n")])])]),a("ul",[a("li",[t._v("exec格式："),a("code",[t._v('RUN ["可执行文件", "参数1", "参数2"]')]),t._v("，这更像是函数调用中的格式。")])]),t._v(" "),a("div",{staticClass:"language-Dockerfile extra-class"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" ["),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"echo"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello world"')]),t._v("]")]),t._v("\n")])])]),a("p",[t._v("Dockerfile中每一个指令都会建立一层，"),a("code",[t._v("RUN")]),t._v("也不例外。每一个"),a("code",[t._v("RUN")]),t._v("的行为，就和刚才我们手工建立镜像的过程一样：新建立一层，在其上执行这些命令，执行结束后，commit这一层的修改，构成新的镜像。")]),t._v(" "),a("h3",{attrs:{id:"cmd"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cmd"}},[t._v("#")]),t._v(" CMD")]),t._v(" "),a("p",[a("code",[t._v("CMD")]),t._v("指令的格式和"),a("code",[t._v("RUN")]),t._v("相似，也是两种格式：")]),t._v(" "),a("ul",[a("li",[t._v("shell格式："),a("code",[t._v("CMD <命令>")])]),t._v(" "),a("li",[t._v("exec格式："),a("code",[t._v('CMD ["可执行文件", "参数1", "参数2"...]')])]),t._v(" "),a("li",[t._v("参数列表格式："),a("code",[t._v('CMD ["参数1", "参数2"...]')]),t._v("，在"),a("code",[t._v("ENTRYPOINT")]),t._v("指令后，用"),a("code",[t._v("CMD")]),t._v("指定具体的参数。")])]),t._v(" "),a("p",[a("code",[t._v("CMD")]),t._v("指令指定容器的默认执行命令，此命令会在容器启动且"),a("code",[t._v("docker run")]),t._v("没有指定其他命令时运行，如果指定了命令则会被替换")]),t._v(" "),a("div",{staticClass:"language-Dockerfile extra-class"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" busybox")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CMD")]),t._v(" ["),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"echo"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello world"')]),t._v("]")]),t._v("\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("➜  /Users/pdd docker run test:v1\nhello world\n\n➜  /Users/pdd docker run -it test:v1 "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sh")]),t._v("\n/ "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n")])])]),a("h3",{attrs:{id:"entrypoint"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#entrypoint"}},[t._v("#")]),t._v(" ENTRYPOINT")]),t._v(" "),a("p",[a("code",[t._v("ENTRYPOINT")]),t._v("的目的和"),a("code",[t._v("CMD")]),t._v("一样，都是在指定容器启动程序及参数。其指令的格式和"),a("code",[t._v("RUN")]),t._v("指令格式一样，分为shell格式和exec格式。")]),t._v(" "),a("div",{staticClass:"language-Dockerfile extra-class"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" busybox")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ENTRYPOINT")]),t._v(" ["),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"echo"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello world"')]),t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CMD")]),t._v(" ["),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('" --- pdd"')]),t._v("]")]),t._v("\n")])])]),a("p",[t._v("当指定了"),a("code",[t._v("ENTRYPOINT")]),t._v("后，"),a("code",[t._v("CMD")]),t._v("的含义就发生了改变，不再是直接的运行其命令，而是将"),a("code",[t._v("CMD")]),t._v("的内容作为参数传给"),a("code",[t._v("ENTRYPOINT")]),t._v("指令")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("➜  /Users/pdd docker run test:v2\nhello world  --- pdd\n")])])]),a("p",[a("code",[t._v("ENTRYPOINT")]),t._v("在运行时也可以替代，不过比"),a("code",[t._v("CMD")]),t._v("要略显繁琐，需要通过 "),a("code",[t._v("docker run")]),t._v("的参数"),a("code",[t._v("--entrypoint")]),t._v("来指定。")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("➜  /Users/pdd docker run -it --entrypoint "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sh"')]),t._v(" test:v2\n/ "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n")])])]),a("h3",{attrs:{id:"env"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#env"}},[t._v("#")]),t._v(" ENV")]),t._v(" "),a("p",[t._v("格式有两种：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("ENV <key> <value>")])]),t._v(" "),a("li",[a("code",[t._v("ENV <key1>=<value1> <key2>=<value2>...")])])]),t._v(" "),a("p",[t._v("这个指令设置环境变量，无论是后面的其它指令，如 "),a("code",[t._v("RUN")]),t._v("，还是运行时的应用，都可以直接使用这里定义的环境变量。")]),t._v(" "),a("div",{staticClass:"language-Dockerfie extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('ENV VERSION=1.0 DEBUG=on \\\n    NAME="Happy Feet"\n')])])]),a("h3",{attrs:{id:"arg"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#arg"}},[t._v("#")]),t._v(" ARG")]),t._v(" "),a("p",[t._v("格式："),a("code",[t._v("ARG <参数名>[=<默认值>]")])]),t._v(" "),a("p",[t._v("构建参数和 "),a("code",[t._v("ENV")]),t._v(" 的效果一样，都是设置环境变量。所不同的是，"),a("code",[t._v("ARG")]),t._v(" 所设置的构建环境的环境变量，在将来容器运行时是不会存在这些环境变量的。但是不要因此就使用 "),a("code",[t._v("ARG")]),t._v(" 保存密码之类的信息，因为 "),a("code",[t._v("docker history")]),t._v(" 还是可以看到所有值的。")]),t._v(" "),a("h3",{attrs:{id:"volume"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#volume"}},[t._v("#")]),t._v(" VOLUME")]),t._v(" "),a("p",[a("code",[t._v("docker run --name webserver -d -p 80:80 -v /data/logs/nginx/:/var/log/nginx nginx")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Mounts"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Type"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bind"')]),t._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Source"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/data/logs/nginx"')]),t._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Destination"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/var/log/nginx"')]),t._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Mode"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"RW"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" true,\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Propagation"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"rprivate"')]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("p",[a("code",[t._v("docker run --name webserver_v2 -d -p 8080:80 -v nginx:/var/log/nginx nginx")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Mounts"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Type"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"volume"')]),t._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Name"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nginx"')]),t._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Source"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/var/lib/docker/volumes/nginx/_data"')]),t._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Destination"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/var/log/nginx"')]),t._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Driver"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"local"')]),t._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Mode"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"z"')]),t._v(",\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"RW"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" true,\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Propagation"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("h3",{attrs:{id:"expose"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#expose"}},[t._v("#")]),t._v(" EXPOSE")]),t._v(" "),a("p",[a("code",[t._v("EXPOSE")]),t._v(" 指令是声明容器运行时提供的服务端口")]),t._v(" "),a("p",[a("code",[t._v("docker run -p <宿主端口>:<容器端口>")]),t._v("，如果宿主端口不指定则服务器随机分配端口")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("➜  ~ docker run --name myapp-v1 -d -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v(" myhttp:v1\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("➜  ~ docker "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v("\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                   NAMES\n3070486b1d6c        myhttp:v1           "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"python httpserver1.…"')]),t._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("54")]),t._v(" minutes ago      Up "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("54")]),t._v(" minutes       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v(".0.0:32768-"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("/tcp   myapp-v1\n")])])]),a("h4",{attrs:{id:"expose和publish-run-p-的区别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#expose和publish-run-p-的区别"}},[t._v("#")]),t._v(" EXPOSE和PUBLISH（run -p）的区别")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("既没有在Dockerfile里Expose, 也没有run -p\n启动在这个container里的服务既不能被host主机和外网访问，也不能被link的container访问，只能在此容器内部使用")])]),t._v(" "),a("li",[a("p",[t._v("只在Dockerfile里Expose了这个端口\n启动在这个container里的服务不能被docker外部世界（host和其他主机）访问，但是可以通过container link，被其他link的container访问到")])]),t._v(" "),a("li",[a("p",[t._v("同时在Dockerfile里Expose，又run -p\n启动的这个cotnainer既可以被docker外部世界访问，也可以被link的container访问")])]),t._v(" "),a("li",[a("p",[t._v("只有run -p\ndocker做了特殊的隐式转换，等价于第一种情况，既可以被外部世界访问，也可以被link的container访问到（真对这种情况，原因是docker认为，既然你都要把port open到外部世界了，等价于其他的container肯定也能访问，所以docker做了自动的Expose")])])]),t._v(" "),a("h3",{attrs:{id:"workdir"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#workdir"}},[t._v("#")]),t._v(" WORKDIR")]),t._v(" "),a("p",[t._v("指定"),a("code",[t._v("dockerfile")]),t._v("的工作目录位置")]),t._v(" "),a("h3",{attrs:{id:"user"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#user"}},[t._v("#")]),t._v(" USER")]),t._v(" "),a("p",[t._v("指定当前用户")]),t._v(" "),a("h3",{attrs:{id:"onbuild"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#onbuild"}},[t._v("#")]),t._v(" ONBUILD")]),t._v(" "),a("p",[t._v("格式："),a("code",[t._v("ONBUILD <其它指令>")]),t._v("。")]),t._v(" "),a("p",[a("code",[t._v("ONBUILD")]),t._v(" 是一个特殊的指令，它后面跟的是其它指令，比如 "),a("code",[t._v("RUN")]),t._v(", "),a("code",[t._v("COPY")]),t._v(" 等，而这些指令，在当前镜像构建时并不会被执行。只有当以当前镜像为基础镜像，去构建下一级镜像的时候才会被执行。")]),t._v(" "),a("p",[t._v("基础镜像")]),t._v(" "),a("div",{staticClass:"language-dockerfile extra-class"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" node:slim")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" mkdir /app")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WORKDIR")]),t._v(" /app")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ONBUILD")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COPY")]),t._v(" ./package.json /app")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ONBUILD")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" [ "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"npm"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"install"')]),t._v(" ]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ONBUILD")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COPY")]),t._v(" . /app/")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CMD")]),t._v(" [ "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"npm"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"start"')]),t._v(" ]")]),t._v("\n")])])]),a("p",[t._v("子镜像")]),t._v(" "),a("div",{staticClass:"language-dockerfile extra-class"},[a("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[a("code",[a("span",{pre:!0,attrs:{class:"token instruction"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" my-node")]),t._v("\n")])])]),a("h3",{attrs:{id:"多阶段构建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#多阶段构建"}},[t._v("#")]),t._v(" 多阶段构建")]),t._v(" "),a("p",[t._v("允许一个Dockerfile 中出现多个 "),a("code",[t._v("FROM")]),t._v(" 指令。")]),t._v(" "),a("h2",{attrs:{id:"容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#容器"}},[t._v("#")]),t._v(" 容器")]),t._v(" "),a("h3",{attrs:{id:"启动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动"}},[t._v("#")]),t._v(" 启动")]),t._v(" "),a("p",[a("code",[t._v("$ docker run ubuntu:18.04 /bin/echo 'Hello world")])]),t._v(" "),a("p",[a("code",[t._v("$ docker run --name webserver -d -p 80:80 nginx")])]),t._v(" "),a("h3",{attrs:{id:"日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#日志"}},[t._v("#")]),t._v(" 日志")]),t._v(" "),a("p",[a("code",[t._v("docker container logs [container ID or NAMES]")])]),t._v(" "),a("h3",{attrs:{id:"终止"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#终止"}},[t._v("#")]),t._v(" 终止")]),t._v(" "),a("p",[a("code",[t._v("docker container stop|start|restart")])]),t._v(" "),a("p",[t._v("终止状态的容器可以用 "),a("code",[t._v("docker container ls -a")]),t._v(" 命令看到。")]),t._v(" "),a("h3",{attrs:{id:"进入"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#进入"}},[t._v("#")]),t._v(" 进入")]),t._v(" "),a("p",[a("code",[t._v("$ docker exec -it webserver bash")])]),t._v(" "),a("h3",{attrs:{id:"删除"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除"}},[t._v("#")]),t._v(" 删除")]),t._v(" "),a("p",[t._v("删除一个处于终止状态的容器。")]),t._v(" "),a("p",[a("code",[t._v("$ docker container rm")])]),t._v(" "),a("p",[t._v("删除一个处于运行状态的容器。")]),t._v(" "),a("p",[a("code",[t._v("$ docker contain rm -f")])]),t._v(" "),a("p",[t._v("清理掉所有处于终止状态的容器")]),t._v(" "),a("p",[a("code",[t._v("$ docker container prune")])]),t._v(" "),a("h2",{attrs:{id:"sdk"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sdk"}},[t._v("#")]),t._v(" SDK")]),t._v(" "),a("h3",{attrs:{id:"go-sdk"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#go-sdk"}},[t._v("#")]),t._v(" Go SDK")]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("go")]),t._v(" get github"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("docker"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("docker"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("client\n")])])]),a("h4",{attrs:{id:"获取容器信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#获取容器信息"}},[t._v("#")]),t._v(" 获取容器信息")]),t._v(" "),a("p",[a("code",[t._v('docker ps -a --filter="name=frontend"')])]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" main\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"context"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fmt"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/docker/docker/api/types"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/docker/docker/api/types/filters"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/docker/docker/client"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  cli"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("NewClientWithOpts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("FromEnv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("WithAPIVersionNegotiation")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    fmt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Printf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"docker api error: %s"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 关闭docker api")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("defer")]),t._v(" cli"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Close")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// docker ps -a --filter "name=frontend"')]),t._v("\n  customFilter "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" filters"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("NewArgs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  customFilter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"lcm_frontend_pdd"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  containers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" cli"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ContainerList")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Background")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" types"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ContainerListOptions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("All"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Filters"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" customFilter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    fmt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Printf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"docker list error: %s"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("len")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("containers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    fmt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"containers not exist"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("_")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" container "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("range")]),t._v(" containers "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    fmt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Printf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ID: %s\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" container"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ID"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    fmt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Printf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Image: %s\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" container"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Image"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    fmt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Printf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"State: %s\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" container"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("State"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h4",{attrs:{id:"获取本地镜像信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#获取本地镜像信息"}},[t._v("#")]),t._v(" 获取本地镜像信息")]),t._v(" "),a("p",[a("code",[t._v("docker images --filter=reference='172.16.81.200:443/library/frontend'")])]),t._v(" "),a("div",{staticClass:"language-go extra-class"},[a("pre",{pre:!0,attrs:{class:"language-go"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" main\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"context"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fmt"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/docker/docker/api/types"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/docker/docker/api/types/filters"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/docker/docker/client"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  cli"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("NewClientWithOpts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("FromEnv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("WithAPIVersionNegotiation")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    fmt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Printf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"docker api error: %s"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 关闭docker api")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("defer")]),t._v(" cli"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Close")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// docker images --filter=reference='172.16.81.200:443/library/frontend'")]),t._v("\n  customFilter "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" filters"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("NewArgs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  customFilter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"reference"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"172.16.81.200:443/library/frontend"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  images"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" cli"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ImageList")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Background")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" types"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ImageListOptions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("All"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Filters"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" customFilter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    fmt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Printf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"docker image error: %s"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("len")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("images"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    fmt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Println")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"images not exist"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("_")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" image "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("range")]),t._v(" images "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    fmt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Printf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ID\\n: %s"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" image"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ID"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    fmt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Printf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Digest: %s\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" image"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("RepoDigests"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    fmt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Printf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Tag: %s\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" image"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("RepoTags"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);