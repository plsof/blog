(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{434:function(s,a,t){"use strict";t.r(a);var n=t(54),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"grains"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#grains"}},[s._v("#")]),s._v(" grains")]),s._v(" "),t("h3",{attrs:{id:"系统grains"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#系统grains"}},[s._v("#")]),s._v(" 系统grains")]),s._v(" "),t("h4",{attrs:{id:"查看minion的所有grains"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看minion的所有grains"}},[s._v("#")]),s._v(" 查看minion的所有grains")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("salt SCYD-192.168.1.10 grains.items\n")])])]),t("h4",{attrs:{id:"查看grains的某个键值-以ipv4这个key为例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看grains的某个键值-以ipv4这个key为例"}},[s._v("#")]),s._v(" 查看grains的某个键值（以ipv4这个key为例）")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("salt SCYD-192.168.1.10 grains.get ipv4\n")])])]),t("h4",{attrs:{id:"删除grains的某个key的值-value会变成none"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#删除grains的某个key的值-value会变成none"}},[s._v("#")]),s._v(" 删除grains的某个key的值（value会变成None）")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("salt SCYD-10.25.172.207 grains.delval ipv4\n")])])]),t("h3",{attrs:{id:"自定义grains"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#自定义grains"}},[s._v("#")]),s._v(" 自定义grains")]),s._v(" "),t("ol",[t("li",[s._v("通过grains模块定义grains")])]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("salt SCYD-192.168.1.10 grains.append roles "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ppl-flume_recommend'")]),s._v("\n")])])]),t("p",[s._v("如果对这个key append另一个值，value则会追加不会覆盖")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("salt SCYD-192.168.1.10 grains.set roles "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ppl-flume_recommend'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("force")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("True\n")])])]),t("p",[s._v("强制覆盖roles")]),s._v(" "),t("p",[s._v("上面命令会在客户端生成个文件 /etc/salt/grains")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /etc/salt/grains")]),s._v("\nroles:\n- ppl-flume_recommend\n")])])]),t("p",[s._v("生效")]),s._v(" "),t("p",[s._v("(1) 重启minion")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("/etc/init.d/salt-minion restart\n")])])]),t("p",[s._v("(2) 强制刷新")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("salt SCYD-192.168.1.10 saltutil.sync_grains\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[s._v("使用自定义python脚本获取grains信息（默认自定义脚本需要存放在master的/srv/salt/_grains目录下）")])]),s._v(" "),t("p",[s._v("示例：获取网卡速率")]),s._v(" "),t("div",{staticClass:"language-python extra-class"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#!/usr/bin/env python")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# coding=utf-8")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" os "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" popen\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get_speed")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    grains "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    grains"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'speed'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" popen"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ip addr | egrep \"10.25.172|10.25.171\" | awk \\'{print $NF}\\' | xargs ethtool | grep Speed | awk \\'{print $NF}\\' '")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("read"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("strip"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" grains\n")])])]),t("p",[s._v("使用sync_grains命令同步脚本到minion主机上去，并通过grains.item命令获取相关信息即可，如下：")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@saltmaster"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# salt '*' saltutil.sync_grains")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@saltmaster"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# salt '*' grains.item speed")]),s._v("\n")])])]),t("p",[s._v("执行同步命令后，自定义脚本会上传到minion的/var/cache/salt/minion/extmods/grains目录下")]),s._v(" "),t("h2",{attrs:{id:"rest-cherrypy"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#rest-cherrypy"}},[s._v("#")]),s._v(" rest_cherrypy")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -k https://127.0.0.1:1559 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-H "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Accept: application/json"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-H "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"X-Auth-Token: a8c0a529b0eb37dee40f0db1287575ddf4dc24b7"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-d "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("client")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'local_async'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-d "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tgt")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'SCYD-*'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-d "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("fun")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'grains.items'")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -k https://127.0.0.1:1559 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-H "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Accept: application/json"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-H "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"X-Auth-Token: a8c0a529b0eb37dee40f0db1287575ddf4dc24b7"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-d "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("client")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'runner'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-d "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jid")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'20200516155008231927'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-d "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("fun")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'jobs.lookup_jid'")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -k https://127.0.0.1:1559 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-H "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Accept: application/json"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-H "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"X-Auth-Token: 0c4bfe286c7b1a3e96c2e9ea50c9b8cc9aab1a18"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-d "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("client")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'local'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-d "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tgt")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'SCYD-10.25.172.1'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-d "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("fun")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'grains.set'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-d "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("arg")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'roles: grainsTest'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-d "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("force")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("True\n\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -k https://10.25.172.67:1559 -H "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Accept: application/json"')]),s._v(" -H "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"X-Auth-Token: 3463d339d29e67e6b70f18d3774a9696a72e2f99"')]),s._v(" -d "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("client")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'local'")]),s._v(" -d "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("tgt")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'SCYD-10.25.172.1'")]),s._v(" -d "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("fun")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'grains.set'")]),s._v(" -d "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("arg")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'roles'")]),s._v(" -d "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("arg")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'myapp2'")]),s._v(" -d "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("arg")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'force'")]),s._v(" -d "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("arg")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'True'")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"client"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"local"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tgt"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SCYD-10.25.172.1"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"fun"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"grains.set"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"arg"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"roles"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"myapp3"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"force=True"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])])])}),[],!1,null,null,null);a.default=e.exports}}]);