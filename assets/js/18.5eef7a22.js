(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{401:function(s,t,a){s.exports=a.p+"assets/img/architecture.cd3a82de.png"},469:function(s,t,a){"use strict";a.r(t);var e=a(54),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"前介"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#前介"}},[s._v("#")]),s._v(" 前介")]),s._v(" "),e("h3",{attrs:{id:"部署"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#部署"}},[s._v("#")]),s._v(" 部署")]),s._v(" "),e("h4",{attrs:{id:"下载-安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#下载-安装"}},[s._v("#")]),s._v(" 下载，安装")]),s._v(" "),e("p",[s._v("二进制方式")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://github.com/prometheus/prometheus/releases/download/v2.14.0/prometheus-2.14.0.linux-amd64.tar.gz -C /data/server/\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /data/server "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -zxv -f prometheus-2.14.0.linux-amd64.tar.gz\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ln")]),s._v(" -s prometheus-2.14.0.linux-amd64 prometheus\n")])])]),e("h4",{attrs:{id:"启动脚本"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#启动脚本"}},[s._v("#")]),s._v(" 启动脚本")]),s._v(" "),e("p",[e("code",[s._v("/etc/systemd/system/prometheus.service")])]),s._v(" "),e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Unit"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nDescription=Prometheus Monitoring System\nDocumentation=Prometheus Monitoring System\n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nExecStart=/data/server/prometheus/prometheus \\\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("config.file=/data/server/prometheus/prometheus.yml \\\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("web.listen"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("address="),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("9090")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Install"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nWantedBy=multi"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("user.target\n")])])]),e("h4",{attrs:{id:"启动"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#启动"}},[s._v("#")]),s._v(" 启动")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("systemctl start prometheus\n")])])]),e("h3",{attrs:{id:"架构"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#架构"}},[s._v("#")]),s._v(" 架构")]),s._v(" "),e("img",{staticStyle:{zoom:"85%"},attrs:{src:a(401),alt:"prometheus"}}),s._v(" "),e("center",[s._v("Prometheus架构")]),s._v(" "),e("h4",{attrs:{id:"promethues-server"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#promethues-server"}},[s._v("#")]),s._v(" Promethues server")]),s._v(" "),e("p",[s._v("Prometheus Server是Prometheus组件中的核心部分，负责实现对监控数据的获\n取，存储以及查询。Prometheus Server可以通过静态配置管理监控目标，也可\n以配合使用Service Discovery的方式动态管理监控目标，并从这些监控目标中获\n取数据。其次Prometheus Server需要对采集到的监控数据进行存储，\nPrometheus Server本身就是一个时序数据库，将采集到的监控数据按照时间序\n列的方式存储在本地磁盘当中。最后Prometheus Server对外提供了自定义的\nPromQL语言，实现对数据的查询以及分析。")]),s._v(" "),e("h4",{attrs:{id:"exporters"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#exporters"}},[s._v("#")]),s._v(" Exporters")]),s._v(" "),e("p",[s._v("Exporter将监控数据采集的端点通过HTTP服务的形式暴露给Prometheus\nServer，Prometheus Server通过访问该Exporter提供的Endpoint端点，即可获取\n到需要采集的监控数据。")]),s._v(" "),e("p",[s._v("一般来说可以将Exporter分为2类：")]),s._v(" "),e("ul",[e("li",[s._v("直接采集：这一类Exporter直接内置了对Prometheus监控的支持，比如\ncAdvisor，Kubernetes，Etcd，Gokit等，都直接内置了用于向Prometheus\n暴露监控数据的端点。")]),s._v(" "),e("li",[s._v("间接采集：间接采集，原有监控目标并不直接支持Prometheus，因此我们需\n要通过Prometheus提供的Client Library编写该监控目标的监控采集程序。例\n如： Mysql Exporter，JMX Exporter，Consul Exporter等。")])]),s._v(" "),e("h4",{attrs:{id:"alertmanager"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#alertmanager"}},[s._v("#")]),s._v(" AlertManager")]),s._v(" "),e("p",[s._v("在Prometheus Server中支持基于PromQL创建告警规则，如果满足PromQL定义\n的规则，则会产生一条告警，而告警的后续处理流程则由AlertManager进行管\n理。在AlertManager中我们可以与邮件，Slack等等内置的通知方式进行集成，\n也可以通过Webhook自定义告警处理方式。AlertManager即Prometheus体系中\n的告警处理中心。")]),s._v(" "),e("h4",{attrs:{id:"pushgateway"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#pushgateway"}},[s._v("#")]),s._v(" PushGateway")]),s._v(" "),e("p",[s._v("由于Prometheus数据采集基于Pull模型进行设计，因此在网络环境的配置上必须\n要让Prometheus Server能够直接与Exporter进行通信。 当这种网络需求无法直\n接满足时，就可以利用PushGateway来进行中转。可以通过PushGateway将内部\n网络的监控数据主动Push到Gateway当中。而Prometheus Server则可以采用同\n样Pull的方式从PushGateway中获取到监控数据。")]),s._v(" "),e("h2",{attrs:{id:"探索promql"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#探索promql"}},[s._v("#")]),s._v(" 探索PromQL")]),s._v(" "),e("h3",{attrs:{id:"理解时间序列"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#理解时间序列"}},[s._v("#")]),s._v(" 理解时间序列")]),s._v(" "),e("p",[s._v("Prometheus会将所有采集到的样本数据以时间序列（time-series）的方式保存在内存数据库中，并且定时保存到硬盘上。time-series是按照时间戳和值的序列顺序存放的，我们称之为向量(vector). 每条time-series通过指标名称(metrics name)和一组标签集(labelset)命名。如下所示，可以将time-series理解为一个以时间为Y轴的数字矩阵：")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("  ^\n  │   "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("   "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("   node_cpu"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("cpu"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cpu0"')]),s._v(",mode"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"idle"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  │     "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("   node_cpu"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("cpu"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cpu0"')]),s._v(",mode"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"system"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  │     "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("   "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("   node_load1"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  │     "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("   "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("  \n  "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("v")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("------------------ 时间 ----------------"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])]),e("p",[s._v("在time-series中的每一个点称为一个样本（sample），样本由以下三部分组成：")]),s._v(" "),e("ul",[e("li",[s._v("指标(metric)：metric name和描述当前样本特征的labelsets")]),s._v(" "),e("li",[s._v("时间戳(timestamp)：一个精确到毫秒的时间戳")]),s._v(" "),e("li",[s._v("样本值(value)： 一个float64的浮点型数据表示当前样本的值")])]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("--------------- metric ---------------------"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("-timestamp -"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("-value-"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nhttp_request_total"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("status"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"200"')]),s._v(", "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("method")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("@1434417560938 "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("94355")]),s._v("\nhttp_request_total"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("status"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"200"')]),s._v(", "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("method")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("@1434417561287 "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("94334")]),s._v("\n\nhttp_request_total"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("status"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"404"')]),s._v(", "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("method")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("@1434417560938 "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("38473")]),s._v("\nhttp_request_total"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("status"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"404"')]),s._v(", "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("method")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("@1434417561287 "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("38544")]),s._v("\n\nhttp_request_total"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("status"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"200"')]),s._v(", "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("method")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"POST"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("@1434417560938 "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4748")]),s._v("\nhttp_request_total"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("status"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"200"')]),s._v(", "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("method")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"POST"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("@1434417561287 "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4785")]),s._v("\n")])])]),e("h3",{attrs:{id:"metrics类型"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#metrics类型"}},[s._v("#")]),s._v(" Metrics类型")]),s._v(" "),e("ol",[e("li",[s._v("Counter（计数器）")]),s._v(" "),e("li",[s._v("Gauge（仪表盘）")]),s._v(" "),e("li",[s._v("Histogram（直方图）")]),s._v(" "),e("li",[s._v("Summary（摘要）")])]),s._v(" "),e("h4",{attrs:{id:"counter-只增不减的计数器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#counter-只增不减的计数器"}},[s._v("#")]),s._v(" Counter：只增不减的计数器")]),s._v(" "),e("p",[s._v("Counter类型的指标其工作方式和计数器一样，只增不减（除非系统发生重置）")]),s._v(" "),e("h4",{attrs:{id:"gauge-可增可减的仪表盘"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#gauge-可增可减的仪表盘"}},[s._v("#")]),s._v(" Gauge：可增可减的仪表盘")]),s._v(" "),e("p",[s._v("Gauge类型的指标侧重于反应系统的当前状态。因此这类指标的样本数据可增可减")]),s._v(" "),e("h4",{attrs:{id:"使用histogram和summary分析数据分布情况"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用histogram和summary分析数据分布情况"}},[s._v("#")]),s._v(" 使用Histogram和Summary分析数据分布情况")]),s._v(" "),e("p",[s._v("Histogram和Summary主用用于统计和分析样本的分布情况。"),e("em",[s._v("Histogram通过histogram_quantile函数是在服务器端计算分位数，而Sumamry的分位数则是直接在客户端计算完成")])]),s._v(" "),e("p",[e("code",[s._v("Summary")])]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# HELP prometheus_tsdb_wal_fsync_duration_seconds Duration of WAL fsync.")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# TYPE prometheus_tsdb_wal_fsync_duration_seconds summary")]),s._v("\nprometheus_tsdb_wal_fsync_duration_seconds"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("quantile"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.5"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.012352463")]),s._v("\nprometheus_tsdb_wal_fsync_duration_seconds"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("quantile"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.9"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.014458005")]),s._v("\nprometheus_tsdb_wal_fsync_duration_seconds"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("quantile"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.99"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.017316173")]),s._v("\nprometheus_tsdb_wal_fsync_duration_seconds_sum "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.888716127000002")]),s._v("\nprometheus_tsdb_wal_fsync_duration_seconds_count "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("216")]),s._v("\n")])])]),e("p",[s._v("从上面的样本中可以得知当前Prometheus Server进行wal_fsync操作的总次数为216次，耗时2.888716127000002s。其中中位数（quantile=0.5）的耗时为0.012352463，9分位数（quantile=0.9）的耗时为0.014458005s （50%耗时<=0.012352463，90%耗时<=0.014458005）")]),s._v(" "),e("p",[e("code",[s._v("Histogram")])]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# HELP prometheus_tsdb_compaction_chunk_range Final time range of chunks on their first compaction")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# TYPE prometheus_tsdb_compaction_chunk_range histogram")]),s._v("\nprometheus_tsdb_compaction_chunk_range_bucket"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("le"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"100"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nprometheus_tsdb_compaction_chunk_range_bucket"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("le"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"400"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nprometheus_tsdb_compaction_chunk_range_bucket"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("le"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1600"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nprometheus_tsdb_compaction_chunk_range_bucket"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("le"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"6400"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nprometheus_tsdb_compaction_chunk_range_bucket"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("le"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"25600"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nprometheus_tsdb_compaction_chunk_range_bucket"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("le"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"102400"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nprometheus_tsdb_compaction_chunk_range_bucket"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("le"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"409600"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nprometheus_tsdb_compaction_chunk_range_bucket"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("le"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.6384e+06"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("260")]),s._v("\nprometheus_tsdb_compaction_chunk_range_bucket"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("le"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"6.5536e+06"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("780")]),s._v("\nprometheus_tsdb_compaction_chunk_range_bucket"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("le"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2.62144e+07"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("780")]),s._v("\nprometheus_tsdb_compaction_chunk_range_bucket"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("le"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"+Inf"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("780")]),s._v("\nprometheus_tsdb_compaction_chunk_range_sum "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".1540798e+09\nprometheus_tsdb_compaction_chunk_range_count "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("780")]),s._v("\n")])])]),e("p",[s._v("Histogram指标直接反应了在不同区间内样本的个数，区间通过标签len进行定义")]),s._v(" "),e("h3",{attrs:{id:"初识promql"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#初识promql"}},[s._v("#")]),s._v(" 初识PromQL")]),s._v(" "),e("p",[s._v("数据类型")]),s._v(" "),e("p",[e("code",[s._v("瞬时向量表达式，选择当前最新的数据")])]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("http_request_total"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),e("p",[e("code",[s._v("区间向量表达式，选择以当前时间为基准，5分钟内的数据")])]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("http_request_total"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("5m"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),e("p",[e("code",[s._v("标量，标量只有一个数字，没有时序")])]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n")])])]),e("p",[e("code",[s._v("字符串")])]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"this is a string"')]),s._v("\n")])])]),e("h3",{attrs:{id:"聚合查询"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#聚合查询"}},[s._v("#")]),s._v(" 聚合查询")]),s._v(" "),e("p",[s._v("统计各实例CPU非idle时间的使用率")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("sum"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("avg"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("irate"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("node_cpu_seconds_total"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("mode"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"idle"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("5m"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v(" without "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cpu"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" by "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("instance"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),e("h3",{attrs:{id:"内置函数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#内置函数"}},[s._v("#")]),s._v(" 内置函数")]),s._v(" "),e("h4",{attrs:{id:"increase"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#increase"}},[s._v("#")]),s._v(" increase")]),s._v(" "),e("p",[e("code",[s._v("increase(v range-vector)")]),s._v("函数获取区间向量中的第一个和最后一个样本并返回其增长量，它会在单调性发生变化时(如由于采样目标重启引起的计数器复位)自动中断。由于这个值被外推到指定的整个时间范围，所以即使样本值都是整数，你仍然可能会得到一个非整数值")]),s._v(" "),e("p",[s._v("最近一分钟cpu非idle利用率：")]),s._v(" "),e("p",[e("code",[s._v('(1 - (sum(increase(node_cpu_seconds_total{mode="idle"}[1m])) by(instance)) / (sum(increase(node_cpu_seconds_total[1m])) by(instance))) * 100')])]),s._v(" "),e("h4",{attrs:{id:"rate"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#rate"}},[s._v("#")]),s._v(" rate")]),s._v(" "),e("p",[s._v("rate函数专门搭配counter类型数据使用，它计算counter在某个时间段平均每秒的增量")]),s._v(" "),e("p",[e("code",[s._v("rate(node_network_receive_bytes_total[1m])")])]),s._v(" "),e("h4",{attrs:{id:"sum"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#sum"}},[s._v("#")]),s._v(" sum")]),s._v(" "),e("h4",{attrs:{id:"topk"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#topk"}},[s._v("#")]),s._v(" topk")]),s._v(" "),e("p",[e("code",[s._v("topk(3,rate(node_network_receive_bytes_total[1m]))")])]),s._v(" "),e("h4",{attrs:{id:"count"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#count"}},[s._v("#")]),s._v(" count")])],1)}),[],!1,null,null,null);t.default=n.exports}}]);