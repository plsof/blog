(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{389:function(s,a,t){s.exports=t.p+"assets/img/kibana1.7688b8a8.png"},390:function(s,a,t){s.exports=t.p+"assets/img/kibana2.7b4ee3ba.png"},425:function(s,a,t){"use strict";t.r(a);var e=t(54),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"简介"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[s._v("#")]),s._v(" 简介")]),s._v(" "),e("h3",{attrs:{id:"收集方式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#收集方式"}},[s._v("#")]),s._v(" 收集方式")]),s._v(" "),e("p",[e("code",[s._v("kubernetes")]),s._v("集群本身不提供日志收集的解决方案，一般来说主要有三种方案：")]),s._v(" "),e("ol",[e("li",[s._v("在节点上运行一个agent（DaemonSet）来收集日志")]),s._v(" "),e("li",[s._v("在Pod中包含一个sidecar容器来收集应用日志")]),s._v(" "),e("li",[s._v("直接在应用程序中将日志信息推送到采集后端")])]),s._v(" "),e("p",[s._v("参考："),e("code",[s._v("https://www.qikqiak.com/post/kubernetes-logs-architecture/")])]),s._v(" "),e("h3",{attrs:{id:"推荐方案"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#推荐方案"}},[s._v("#")]),s._v(" 推荐方案")]),s._v(" "),e("p",[e("code",[s._v("kubernetes")]),s._v("中比较流行的日志收集解决方案是"),e("code",[s._v("Elasticsearch")]),s._v("、"),e("code",[s._v("Fluentd")]),s._v("和"),e("code",[s._v("Kibana")]),s._v("（EFK）技术栈，也是官方现在比较推荐的一种方案")]),s._v(" "),e("h2",{attrs:{id:"部署"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#部署"}},[s._v("#")]),s._v(" 部署")]),s._v(" "),e("h3",{attrs:{id:"前提"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#前提"}},[s._v("#")]),s._v(" 前提")]),s._v(" "),e("p",[s._v("下面的案例使用helm来部署EFK, "),e("strong",[s._v("elasticsearch的版本必须和kibana的版本一致")])]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"center"}},[s._v("CHART")]),s._v(" "),e("th",{staticStyle:{"text-align":"center"}},[s._v("APP VERSION")])])]),s._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"center"}},[s._v("elasticsearch-11.0.18")]),s._v(" "),e("td",{staticStyle:{"text-align":"center"}},[s._v("7.6.2")])]),s._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[s._v("fluentd-elasticsearch-6.2.4")]),s._v(" "),e("td",{staticStyle:{"text-align":"center"}},[s._v("3.0.0")])]),s._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[s._v("kibana-5.0.14")]),s._v(" "),e("td",{staticStyle:{"text-align":"center"}},[s._v("7.6.2")])])])]),s._v(" "),e("p",[s._v("创建命名空间：")]),s._v(" "),e("p",[e("code",[s._v("kubectl create ns efk")])]),s._v(" "),e("h3",{attrs:{id:"elasticsearch"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#elasticsearch"}},[s._v("#")]),s._v(" elasticsearch")]),s._v(" "),e("p",[s._v("添加bitnami repo：")]),s._v(" "),e("p",[e("code",[s._v("helm repo add bitnami https://charts.bitnami.com/bitnami")])]),s._v(" "),e("p",[s._v("下载package：")]),s._v(" "),e("p",[e("code",[s._v("helm fetch bitnami/elasticsearch --version 11.0.18 --untar")])]),s._v(" "),e("p",[s._v("修改参数：")]),s._v(" "),e("ul",[e("li",[s._v("使用存储卷")])]),s._v(" "),e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("persistence")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enabled")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storageClass")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"managed-nfs-storage"')]),s._v("\n")])])]),e("p",[s._v("安装：")]),s._v(" "),e("p",[e("code",[s._v("helm install es-release bitnami/elasticsearch --version 11.0.18 -n efk -f elasticsearch/values.yaml")])]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("NAME: es-release\nLAST DEPLOYED: Fri Apr "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":06:41 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("\nNAMESPACE: efk\nSTATUS: deployed\nREVISION: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nTEST SUITE: None\nNOTES:\n-------------------------------------------------------------------------------\n WARNING\n\n    Elasticsearch requires some changes "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" the kernel of the "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" machine to\n    work as expected. If those values are not "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" the underlying operating\n    system, the ES containers fail to boot with ERROR messages.\n\n    More information about these requirements can be found "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" the links below:\n\n      https://www.elastic.co/guide/en/elasticsearch/reference/current/file-descriptors.html\n      https://www.elastic.co/guide/en/elasticsearch/reference/current/vm-max-map-count.html\n\n    This chart uses a privileged initContainer to change those settings "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" the Kernel\n    by running: sysctl -w vm.max_map_count"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("262144")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" sysctl -w fs.file-max"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),s._v("\n\n** Please be patient "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" the chart is being deployed **\n\n  Elasticsearch can be accessed within the cluster on port "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("9200")]),s._v(" at es-release-elasticsearch-coordinating-only.efk.svc.cluster.local\n\n  To access from outside the cluster execute the following commands:\n\n    "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NODE_PORT")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl get --namespace efk -o "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{.spec.ports[0].nodePort}"')]),s._v(" services es-release-elasticsearch-coordinating-only"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NODE_IP")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl get nodes --namespace efk -o "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{.items[0].status.addresses[0].address}"')]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" http://"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NODE_IP")]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NODE_PORT")]),s._v("/\n")])])]),e("p",[s._v("测试：")]),s._v(" "),e("ul",[e("li",[s._v("测试端口")]),s._v(" "),e("li",[s._v("查看节点状态")])]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl run cirros --rm -it --image=cirros  -- /bin/sh")]),s._v("\nkubectl run --generator"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("deployment/apps.v1 is DEPRECATED and will be removed "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" a future version. Use kubectl run --generator"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("run-pod/v1 or kubectl create instead.\nIf you don't see a "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" prompt, try pressing enter.\n/ "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl es-release-elasticsearch-coordinating-only.efk.svc.cluster.local:9200")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"es-release-elasticsearch-coordinating-only-868b99f9b-szbcm"')]),s._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cluster_name"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"elastic"')]),s._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cluster_uuid"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"o9QJY50SQluG3dyMF5WmSw"')]),s._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"version"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"number"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"7.6.2"')]),s._v(",\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"build_flavor"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"oss"')]),s._v(",\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"build_type"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tar"')]),s._v(",\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"build_hash"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ef48eb35cf30adf4db14086e8aabd07ef6fb113f"')]),s._v(",\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"build_date"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2020-03-26T06:34:37.794943Z"')]),s._v(",\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"build_snapshot"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" false,\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lucene_version"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"8.4.0"')]),s._v(",\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"minimum_wire_compatibility_version"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"6.8.0"')]),s._v(",\n    "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"minimum_index_compatibility_version"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"6.0.0-beta1"')]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tagline"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"You Know, for Search"')]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n/ "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl es-release-elasticsearch-coordinating-only.efk.svc.cluster.local:9200/_cat/nodes?v")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v("          heap.percent ram.percent cpu load_1m load_5m load_15m node.role master name\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".1.86           "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("52")]),s._v("          "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v("   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.01")]),s._v("    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.09")]),s._v("     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.13")]),s._v(" d         -      es-release-elasticsearch-data-1\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".1.85           "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("41")]),s._v("          "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v("   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.01")]),s._v("    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.09")]),s._v("     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.13")]),s._v(" m         *      es-release-elasticsearch-master-1\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".2.86           "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("          "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v("   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.15")]),s._v("    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.19")]),s._v("     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.22")]),s._v(" d         -      es-release-elasticsearch-data-0\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".2.87           "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("37")]),s._v("          "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v("   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.15")]),s._v("    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.19")]),s._v("     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.22")]),s._v(" m         -      es-release-elasticsearch-master-0\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".2.85           "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("53")]),s._v("          "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v("   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.15")]),s._v("    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.19")]),s._v("     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.22")]),s._v(" -         -      es-release-elasticsearch-coordinating-only-868b99f9b-szbcm\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".1.84           "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("44")]),s._v("          "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v("   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.01")]),s._v("    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.09")]),s._v("     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.13")]),s._v(" -         -      es-release-elasticsearch-coordinating-only-868b99f9b-nmmzp\n")])])]),e("h3",{attrs:{id:"fluentd"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#fluentd"}},[s._v("#")]),s._v(" fluentd")]),s._v(" "),e("p",[s._v("这里使用"),e("code",[s._v("DaemonSet")]),s._v("的方式部署fluentd")]),s._v(" "),e("p",[s._v("添加kiwigrid repo：")]),s._v(" "),e("p",[e("code",[s._v("helm repo add kiwigrid https://kiwigrid.github.io")])]),s._v(" "),e("p",[s._v("下载package：")]),s._v(" "),e("p",[e("code",[s._v("helm fetch kiwigrid/fluentd-elasticsearch --version 3.0.0 --untar")])]),s._v(" "),e("p",[s._v("修改参数：")]),s._v(" "),e("ul",[e("li",[s._v("修改elasticsearch host")]),s._v(" "),e("li",[s._v("允许收集master节点的pod日志")])]),s._v(" "),e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("elasticsearch")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"es-release-elasticsearch-coordinating-only.efk.svc.cluster.local"')]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tolerations")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n   "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("key")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" node"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("role.kubernetes.io/master\n     "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("operator")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Exists\n     "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("effect")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" NoSchedule\n")])])]),e("p",[s._v("安装：")]),s._v(" "),e("p",[e("code",[s._v("helm install fe-release --namespace efk -f fluentd-elasticsearch/values.yaml kiwigrid/fluentd-elasticsearch --version 3.0.0")])]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("NAME: fe-release\nLAST DEPLOYED: Fri Apr "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(":24:22 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("\nNAMESPACE: efk\nSTATUS: deployed\nREVISION: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nTEST SUITE: None\nNOTES:\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(". To verify that Fluentd has started, run:\n\n  kubectl --namespace"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("efk get pods -l "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"app.kubernetes.io/name=fluentd-elasticsearch,app.kubernetes.io/instance=fe-release"')]),s._v("\n\nTHIS APPLICATION CAPTURES ALL CONSOLE OUTPUT AND FORWARDS IT TO elasticsearch "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" Anything that might be identifying,\nincluding things like IP addresses, container images, and object names will NOT be anonymized.\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(". Get the application URL by running these commands:\n  "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("POD_NAME")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl get pods --namespace efk -l "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"app.kubernetes.io/name=fluentd-elasticsearch,app.kubernetes.io/instance=fe-release"')]),s._v(" -o "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{.items[0].metadata.name}"')]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Visit http://127.0.0.1:8080 to use your application"')]),s._v("\n  kubectl port-forward "),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$POD_NAME")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(":80\n")])])]),e("p",[s._v("测试：")]),s._v(" "),e("ul",[e("li",[s._v("查看生成的index")])]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl run cirros --rm -it --image=cirros  -- /bin/sh")]),s._v("\nkubectl run --generator"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("deployment/apps.v1 is DEPRECATED and will be removed "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" a future version. Use kubectl run --generator"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("run-pod/v1 or kubectl create instead.\nIf you don't see a "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" prompt, try pressing enter.\n/ "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl es-release-elasticsearch-coordinating-only.efk.svc.cluster.local:9200/_cat/indices?v")]),s._v("\nhealth status index               uuid                   pri rep docs.count docs.deleted store.size pri.store.size\ngreen  "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v("   logstash-2020.04.17 FgvPHuA0R-yf-5y3otDNnQ   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("326045")]),s._v("            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("175")]),s._v(".8mb           88mb\ngreen  "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v("   .kibana_1           5G0PnvrUSbmKyLdCzvO04w   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("          "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("      146kb           73kb\n")])])]),e("h3",{attrs:{id:"kibana"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#kibana"}},[s._v("#")]),s._v(" kibana")]),s._v(" "),e("p",[s._v("下载package：")]),s._v(" "),e("p",[e("code",[s._v("helm fetch bitnami/kibana --version 5.0.14 --untar")])]),s._v(" "),e("p",[s._v("修改参数：")]),s._v(" "),e("ul",[e("li",[s._v("使用存储卷")]),s._v(" "),e("li",[s._v("使用NodePort发布服务")]),s._v(" "),e("li",[s._v("修改elasticsearch host")])]),s._v(" "),e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("persistence")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enabled")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storageClass")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"managed-nfs-storage"')]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("service")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" NodePort\n\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("elasticsearch")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" es"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("release"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("elasticsearch"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("coordinating"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("only.efk.svc.cluster.local\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("9200")]),s._v("\n")])])]),e("p",[s._v("安装：")]),s._v(" "),e("p",[e("code",[s._v("helm install kb-release bitnami/kibana --version 5.0.14 -n efk -f kibana/values.yaml")])]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("NAME: kb-release\nLAST DEPLOYED: Fri Apr "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(":00:52 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("\nNAMESPACE: efk\nSTATUS: deployed\nREVISION: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nNOTES:\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(". Get the application URL by running these commands:\n  "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NODE_PORT")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl get --namespace efk -o "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{.spec.ports[0].nodePort}"')]),s._v(" services kb-release-kibana"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NODE_IP")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl get nodes --namespace efk -o "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{.items[0].status.addresses[0].address}"')]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" http://"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NODE_IP")]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$NODE_PORT")]),s._v("\n\nWARNING: Kibana is externally accessible from the cluster but the dashboard does not contain authentication mechanisms. Make sure you follow the authentication guidelines "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" your Elastic stack.\n+info https://www.elastic.co/guide/en/elastic-stack-overview/current/setting-up-authentication.html\n")])])]),e("p",[s._v("添加index：")]),s._v(" "),e("img",{staticStyle:{zoom:"85%"},attrs:{src:t(389),alt:"kibana-index"}}),s._v(" "),e("p",[s._v("页面展示：")]),s._v(" "),e("img",{staticStyle:{zoom:"85%"},attrs:{src:t(390),alt:"kibana-index"}})])}),[],!1,null,null,null);a.default=n.exports}}]);