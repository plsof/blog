(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{426:function(s,t,e){"use strict";e.r(t);var a=e(54),n=Object(a.a)({},(function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"准备"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#准备"}},[s._v("#")]),s._v(" 准备")]),s._v(" "),e("h3",{attrs:{id:"系统配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#系统配置"}},[s._v("#")]),s._v(" 系统配置")]),s._v(" "),e("p",[s._v("环境\nKubernetes版本："),e("code",[s._v("1.16.7")])]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# CentOS7")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.188")]),s._v(".2.71 "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# master")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.188")]),s._v(".2.86 "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# node1")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.188")]),s._v(".2.87 "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# node2")]),s._v("\n")])])]),e("p",[s._v("关闭防火墙")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("systemctl stop firewalld\nsystemctl disable firewalld\n")])])]),e("p",[s._v("禁用SELINUX")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/selinux/config\n"),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SELINUX")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("disabled\n")])])]),e("p",[s._v("优化内核参数\n"),e("code",[s._v("/etc/sysctl.d/k8s.conf")])]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("net.bridge.bridge-nf-call-ip6tables "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nnet.bridge.bridge-nf-call-iptables "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nnet.ipv4.ip_forward "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])])]),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("modprobe br_netfilter\nsysctl -p /etc/sysctl.d/k8s.conf\n")])])]),e("p",[s._v("kube-proxy开启ipvs的前置条件")]),s._v(" "),e("p",[e("code",[s._v("由于ipvs已经加入到了内核，所以为kube-proxy开启ipvs的前提需要加载以下的内核模块")])]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("ip_vs\nip_vs_rr\nip_vs_wrr\nip_vs_sh\nnf_conntrack_ipv4\n")])])]),e("p",[s._v("在所有机器上执行以下脚本")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/sysconfig/modules/ipvs.modules "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF\n#!/bin/bash\nmodprobe -- ip_vs\nmodprobe -- ip_vs_rr\nmodprobe -- ip_vs_wrr\nmodprobe -- ip_vs_sh\nmodprobe -- nf_conntrack_ipv4\nEOF")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("755")]),s._v(" /etc/sysconfig/modules/ipvs.modules "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v(" /etc/sysconfig/modules/ipvs.modules "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" lsmod "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" -e ip_vs -e nf_conntrack_ipv4\n")])])]),e("p",[s._v("上面脚本创建了的/etc/sysconfig/modules/ipvs.modules文件，保证在节点重启后能自动加载所需模块。 使用lsmod | grep -e ip_vs -e nf_conntrack_ipv4命令查看是否已经正确加载所需的内核模块。")]),s._v(" "),e("p",[s._v("接下来还需要确保各个节点上已经安装了ipset软件包yum install ipset。 为了便于查看ipvs的代理规则，最好安装一下管理工具ipvsadm yum install ipvsadm。")]),s._v(" "),e("p",[s._v("如果以上前提条件如果不满足，则即使kube-proxy的配置开启了ipvs模式，也会退回到iptables模式。")]),s._v(" "),e("h3",{attrs:{id:"安装docker"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装docker"}},[s._v("#")]),s._v(" 安装Docker")]),s._v(" "),e("p",[s._v("安装docker的yum源")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\n")])])]),e("p",[s._v("查看最新的Docker版本")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("yum list docker-ce.x86_64  --showduplicates "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sort")]),s._v(" -r\ndocker-ce.x86_64            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(":19.03.5-3.el7                    docker-ce-stable\ndocker-ce.x86_64            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(":19.03.4-3.el7                    docker-ce-stable\ndocker-ce.x86_64            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(":19.03.3-3.el7                    docker-ce-stable\ndocker-ce.x86_64            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(":19.03.2-3.el7                    docker-ce-stable\ndocker-ce.x86_64            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(":19.03.1-3.el7                    docker-ce-stable\ndocker-ce.x86_64            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(":19.03.0-3.el7                    docker-ce-stable\ndocker-ce.x86_64            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(":18.09.9-3.el7                    docker-ce-stable\ndocker-ce.x86_64            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(":18.09.8-3.el7                    docker-ce-stable\ndocker-ce.x86_64            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(":18.09.7-3.el7                    docker-ce-stable\ndocker-ce.x86_64            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(":18.09.7-3.el7                    @docker-ce-stable\ndocker-ce.x86_64            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(":18.09.6-3.el7                    docker-ce-stable\ndocker-ce.x86_64            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(":18.09.5-3.el7                    docker-ce-stable\ndocker-ce.x86_64            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(":18.09.4-3.el7                    docker-ce-stable\ndocker-ce.x86_64            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(":18.09.3-3.el7                    docker-ce-stable\ndocker-ce.x86_64            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(":18.09.2-3.el7                    docker-ce-stable\ndocker-ce.x86_64            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(":18.09.1-3.el7                    docker-ce-stable\ndocker-ce.x86_64            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(":18.09.0-3.el7                    docker-ce-stable\ndocker-ce.x86_64            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("18.06")]),s._v(".3.ce-3.el7                   docker-ce-stable\ndocker-ce.x86_64            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("18.06")]),s._v(".2.ce-3.el7                   docker-ce-stable\ndocker-ce.x86_64            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("18.06")]),s._v(".1.ce-3.el7                   docker-ce-stable\ndocker-ce.x86_64            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("18.06")]),s._v(".0.ce-3.el7                   docker-ce-stable\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])])]),e("p",[s._v("Kubernetes 1.15当前支持的docker版本列表是1.13.1, 17.03, 17.06, 17.09, 18.06, 18.09。这里在各节点安装docker的18.09.7版本")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("yum makecache fast\n\nyum "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y --setopt"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("obsoletes"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" docker-ce-18.09.7-3.el7 \n\nsystemctl start docker\nsystemctl "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" docker\n")])])]),e("p",[s._v("确认一下iptables filter表中FOWARD链的默认策略(pllicy)为ACCEPT")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# iptables -L -n -v")]),s._v("\nChain INPUT "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("policy ACCEPT "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1928")]),s._v(" packets, 317K bytes"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n pkts bytes target     prot opt "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("     out     "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v("               destination\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("30616")]),s._v(" 1597K KUBE-SERVICES  all  --  *      *       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0/0            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0/0            ctstate NEW /* kubernetes "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" portals */\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("30616")]),s._v(" 1597K KUBE-EXTERNAL-SERVICES  all  --  *      *       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0/0            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0/0            ctstate NEW /* kubernetes externally-visible "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" portals */\n1249K  222M KUBE-FIREWALL  all  --  *      *       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0/0            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0/0\n\nChain FORWARD "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("policy ACCEPT "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" packets, "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" bytes"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n pkts bytes target     prot opt "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("     out     "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v("               destination\n "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3816")]),s._v("  175K KUBE-FORWARD  all  --  *      *       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0/0            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0/0            /* kubernetes forwarding rules */\n "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3812")]),s._v("  174K KUBE-SERVICES  all  --  *      *       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0/0            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0/0            ctstate NEW /* kubernetes "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" portals */\n "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3812")]),s._v("  174K DOCKER-"),e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v("  all  --  *      *       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0/0            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0/0\n")])])]),e("p",[s._v("修改docker cgroup driver为systemd")]),s._v(" "),e("p",[s._v("根据文档CRI installation中的内容，对于使用systemd作为init system的Linux的发行版，使用systemd作为docker的cgroup driver可以确保服务器节点在资源紧张的情况更加稳定，因此这里修改各个节点上docker的cgroup driver为systemd。")]),s._v(" "),e("p",[s._v("创建或修改"),e("code",[s._v("/etc/docker/daemon.json")])]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"exec-opts"')]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"native.cgroupdriver=systemd"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("systemctl restart docker\n\ndocker info "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" Cgroup\nCgroup Driver: systemd\n")])])]),e("h3",{attrs:{id:"关闭swap"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#关闭swap"}},[s._v("#")]),s._v(" 关闭Swap")]),s._v(" "),e("p",[s._v("Kubernetes 1.8开始要求关闭系统的Swap，如果不关闭，默认配置下kubelet将无法启动。关闭系统的Swap方法如下")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("swapoff -a\n")])])]),e("p",[s._v("修改 /etc/fstab 文件，注释掉 SWAP 的自动挂载，使用free -m确认swap已经关闭。 swappiness参数调整，修改/etc/sysctl.d/k8s.conf添加下面一行")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("vm.swappiness"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])])]),e("p",[s._v("执行"),e("code",[s._v("sysctl -p /etc/sysctl.d/k8s.conf")]),s._v("使修改生效。")]),s._v(" "),e("h2",{attrs:{id:"使用kubeadm部署k8s"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用kubeadm部署k8s"}},[s._v("#")]),s._v(" 使用kubeadm部署k8s")]),s._v(" "),e("h3",{attrs:{id:"安装kubeadm"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装kubeadm"}},[s._v("#")]),s._v(" 安装kubeadm")]),s._v(" "),e("p",[s._v("安装yum源")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),e("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/yum.repos.d/kubernetes.repo")]),s._v("\n[kubernetes]\nname=Kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64\nenabled=1\ngpgcheck=1\nrepo_gpgcheck=1\ngpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\nEOF")]),s._v("\n")])])]),e("p",[s._v("安装kubelet kubeadm kubectl")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("yum "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y kubelet-1.16.7 kubeadm-1.16.7 kubectl-1.16.7\n")])])]),e("p",[s._v("各节点开机启动kubelet服务")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("systemctl "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" kubelet.service\n")])])]),e("h3",{attrs:{id:"初始化master"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#初始化master"}},[s._v("#")]),s._v(" 初始化Master")]),s._v(" "),e("p",[s._v("生成master初始化文件")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("kubeadm config print init-defaults "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" kubeadm-init.yaml\n")])])]),e("p",[s._v("该文件有三处需要修改")]),s._v(" "),e("ol",[e("li",[s._v("将"),e("code",[s._v("advertiseAddress: 1.2.3.4")]),s._v("修改为本机地址")]),s._v(" "),e("li",[s._v("将"),e("code",[s._v("imageRepository: k8s.gcr.io")]),s._v("修改为"),e("code",[s._v("imageRepository: registry.cn-hangzhou.aliyuncs.com/google_containers")])]),s._v(" "),e("li",[s._v("添加"),e("code",[s._v("--pod-network-cidr")]),s._v("配置"),e("code",[s._v("podSubnet")])])]),s._v(" "),e("p",[s._v("修改完毕后文件如下")]),s._v(" "),e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" kubeadm.k8s.io/v1beta2\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("bootstrapTokens")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("groups")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" system"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("bootstrappers"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("kubeadm"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("default"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("node"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("token\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("token")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" abcdef.0123456789abcdef\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ttl")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 24h0m0s\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("usages")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" signing\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" authentication\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" InitConfiguration\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("localAPIEndpoint")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("advertiseAddress")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 172.188.2.71\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("bindPort")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6443")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nodeRegistration")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("criSocket")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /var/run/dockershim.sock\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" master\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("taints")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("effect")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" NoSchedule\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("key")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" node"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("role.kubernetes.io/master\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiServer")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("timeoutForControlPlane")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 4m0s\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" kubeadm.k8s.io/v1beta2\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("certificatesDir")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /etc/kubernetes/pki\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("clusterName")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" kubernetes\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("controllerManager")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dns")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" CoreDNS\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("etcd")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("local")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dataDir")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /var/lib/etcd\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imageRepository")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" registry.cn"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("hangzhou.aliyuncs.com/google_containers\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ClusterConfiguration\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kubernetesVersion")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1.15.7\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("networking")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dnsDomain")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" cluster.local\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("podSubnet")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 10.244.0.0/16\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("serviceSubnet")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 10.96.0.0/12\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("scheduler")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),e("p",[s._v("下载镜像")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("kubeadm config images pull --config kubeadm-init.yaml\n")])])]),e("p",[s._v("执行初始化")]),s._v(" "),e("ol",[e("li",[s._v("配置文件初始化")])]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("kubeadm init --config kubeadm-init.yaml\n")])])]),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("To start using your cluster, you need to run the following as a regular user:\n\n  "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p "),e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube\n  "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -i /etc/kubernetes/admin.conf "),e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube/config\n  "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" -u"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" -g"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube/config\n\nYou should now deploy a pod network to the cluster.\nRun "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubectl apply -f [podnetwork].yaml"')]),s._v(" with one of the options listed at:\n  https://kubernetes.io/docs/concepts/cluster-administration/addons/\n\nThen you can "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" any number of worker nodes by running the following on each as root:\n\nkubeadm "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.188")]),s._v(".2.71:6443 --token abcdef.0123456789abcdef "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    --discovery-token-ca-cert-hash sha256:cd6a2ec0a5da2060bfe0be4b43078f5f11e1dbd1b0d9b0e4d47fce7b764f1f66\n")])])]),e("ol",{attrs:{start:"2"}},[e("li",[s._v("命令行初始化")])]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("kubeadm init --kubernetes-version"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubeadm version -o short"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("  --pod-network-cidr"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".0.0/16 --service-cidr"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.0/12\n")])])]),e("p",[s._v("配置环境, 让当前用户可以执行kubectl命令")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p "),e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -i /etc/kubernetes/admin.conf "),e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube/config\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" -u"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" -g"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),e("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube/config\n")])])]),e("h3",{attrs:{id:"安装pod-network"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装pod-network"}},[s._v("#")]),s._v(" 安装Pod Network")]),s._v(" "),e("p",[s._v("这里选用flannel")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -O https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml\nkubectl apply -f kube-flannel.yml\n")])])]),e("p",[s._v("查看各pod的状态，确保都是Running")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pod --all-namespaces -o wide")]),s._v("\nNAMESPACE     NAME                             READY   STATUS              RESTARTS   AGE    IP             NODE     NOMINATED NODE   READINESS GATES\nkube-system   coredns-645bfc575f-c6rdw         "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running             "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          133m   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".0.18    master   "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nkube-system   coredns-645bfc575f-jvxd2         "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running             "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          133m   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".0.19    master   "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nkube-system   etcd-master                      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running             "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          132m   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.188")]),s._v(".2.71   master   "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nkube-system   kube-apiserver-master            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running             "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          132m   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.188")]),s._v(".2.71   master   "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nkube-system   kube-controller-manager-master   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running             "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          133m   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.188")]),s._v(".2.71   master   "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nkube-system   kube-flannel-ds-amd64-hsxbq      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running             "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          131m   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.188")]),s._v(".2.71   master   "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nkube-system   kube-flannel-ds-amd64-nd65q      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running             "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          131m   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.188")]),s._v(".2.87   node2    "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nkube-system   kube-flannel-ds-amd64-zx4bq      "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running             "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          131m   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.188")]),s._v(".2.86   node1    "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nkube-system   kube-proxy-22rtl                 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running             "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          72m    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.188")]),s._v(".2.86   node1    "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nkube-system   kube-proxy-j7wp8                 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running             "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          72m    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.188")]),s._v(".2.87   node2    "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nkube-system   kube-proxy-jrttm                 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running             "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          72m    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.188")]),s._v(".2.71   master   "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nkube-system   kube-scheduler-master            "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running             "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          132m   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.188")]),s._v(".2.71   master   "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])]),e("h3",{attrs:{id:"添加node节点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#添加node节点"}},[s._v("#")]),s._v(" 添加Node节点")]),s._v(" "),e("p",[s._v("node加入节点，node节点上面执行")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("kubeadm "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.188")]),s._v(".2.71:6443 --token abcdef.0123456789abcdef "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    --discovery-token-ca-cert-hash sha256:cd6a2ec0a5da2060bfe0be4b43078f5f11e1dbd1b0d9b0e4d47fce7b764f1f66\n")])])]),e("p",[s._v("查看节点状态")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get node")]),s._v("\nNAME     STATUS   ROLES    AGE    VERSION\nmaster   Ready    master   138m   v1.15.7\nnode1    Ready    "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   135m   v1.15.7\nnode2    Ready    "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   135m   v1.15.7\n")])])]),e("h3",{attrs:{id:"重置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#重置"}},[s._v("#")]),s._v(" 重置")]),s._v(" "),e("p",[s._v("集群初始化如果遇到问题，可以使用下面的命令进行清理")]),s._v(" "),e("p",[s._v("master")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("kubeadm reset\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -f .kube/config\n")])])]),e("p",[s._v("node")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("kubeadm reset\n")])])]),e("h3",{attrs:{id:"kube-proxy开启ipvs"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#kube-proxy开启ipvs"}},[s._v("#")]),s._v(" kube-proxy开启ipvs")]),s._v(" "),e("p",[s._v("修改ConfigMap的kube-system/kube-proxy中的config.conf，"),e("code",[s._v('mode: "ipvs":')])]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("kubectl edit cm kube-proxy -n kube-system\n")])])]),e("p",[s._v("重启Pod")]),s._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("kubectl get pod -n kube-system "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" kube-proxy "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{system("kubectl delete pod "$1" -n kube-system")}\'')]),s._v("\n")])])]),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pod -n kube-system | grep kube-proxy")]),s._v("\nkube-proxy-22rtl                 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          87m\nkube-proxy-j7wp8                 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          87m\nkube-proxy-jrttm                 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          87m\n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl logs kube-proxy-22rtl -n kube-system")]),s._v("\nI0208 08:03:17.814816       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" server_others.go:170"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Using ipvs Proxier.\nW0208 08:03:17.815165       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" proxier.go:401"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" IPVS scheduler not specified, use rr by default\nI0208 08:03:17.815331       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" server.go:534"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Version: v1.15.7\nI0208 08:03:17.828436       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" conntrack.go:52"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Setting nf_conntrack_max to "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("524288")]),s._v("\nI0208 08:03:17.828670       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" config.go:187"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Starting "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" config controller\nI0208 08:03:17.828708       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" controller_utils.go:1029"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Waiting "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" caches to "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sync")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" config controller\nI0208 08:03:17.828846       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" config.go:96"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Starting endpoints config controller\nI0208 08:03:17.828895       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" controller_utils.go:1029"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Waiting "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" caches to "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sync")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" endpoints config controller\nI0208 08:03:17.928850       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" controller_utils.go:1036"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Caches are synced "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" config controller\nI0208 08:03:17.929058       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" controller_utils.go:1036"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Caches are synced "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" endpoints config controller\n")])])]),e("h2",{attrs:{id:"参考"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[s._v("#")]),s._v(" 参考")]),s._v(" "),e("p",[e("code",[s._v("https://blog.frognew.com/2019/07/kubeadm-install-kubernetes-1.15.html")])]),s._v(" "),e("p",[e("code",[s._v("https://juejin.im/post/5d7fb46d5188253264365dcf")])])])}),[],!1,null,null,null);t.default=n.exports}}]);