(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{422:function(t,a,s){"use strict";s.r(a);var e=s(54),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[t._v("#")]),t._v(" 概述")]),t._v(" "),s("p",[t._v("Kubernetes Dashboard是Kubernetes的官方Web UI。项目地址"),s("code",[t._v("https://github.com/kubernetes/dashboard")])]),t._v(" "),s("h2",{attrs:{id:"安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[t._v("#")]),t._v(" 安装")]),t._v(" "),s("p",[t._v("版本"),s("code",[t._v("v2.0.0-beta8")]),t._v("，支持的k8s版本"),s("code",[t._v("1.16")])]),t._v(" "),s("p",[t._v("删除之前的旧版本")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl delete ns kubernetes-dashboard")]),t._v("\n")])])]),s("p",[t._v("安装新版本")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0-beta8/aio/deploy/recommended.yaml")]),t._v("\n")])])]),s("h2",{attrs:{id:"访问"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#访问"}},[t._v("#")]),t._v(" 访问")]),t._v(" "),s("p",[t._v("Kubernetes Dashboard 当前，只支持使用Bearer Token登录。由于Kubernetes Dashboard默认部署时，只配置了最低权限的RBAC。因此，我们要创建一个名为"),s("code",[t._v("admin-user")]),t._v("的ServiceAccount，再创建一个ClusterRolebinding，将其绑定到Kubernetes集群中默认初始化的"),s("code",[t._v("cluster-admin")]),t._v("这个ClusterRole。")]),t._v(" "),s("blockquote",[s("p",[t._v("更多关于权限管理的信息，请参考"),s("a",{attrs:{href:"https://kubernetes.io/docs/reference/access-authn-authz/rbac/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Using RBAC Authorization"),s("OutboundLink")],1)])]),t._v(" "),s("h3",{attrs:{id:"创建账号"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建账号"}},[t._v("#")]),t._v(" 创建账号")]),t._v(" "),s("p",[t._v("创建Service Account和ClusterRoleBinding，使用kubeadm安装集群时，默认创建了ClusterRole"),s("code",[t._v("cluster-admin")]),t._v("。此时我们可以直接为刚才的ServiceAccount创建ClusterRoleBinding。")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ServiceAccount\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" admin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("user\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dashboard\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io/v1\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ClusterRoleBinding\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" admin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("user\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("roleRef")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiGroup")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" rbac.authorization.k8s.io\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ClusterRole\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cluster"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("admin\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("subjects")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ServiceAccount\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" admin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("user\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("dashboard\n")])])]),s("p",[t._v("将上述yaml内容保存为auth.yaml并执行")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl apply -f ./auth.yaml")]),t._v("\n")])])]),s("h3",{attrs:{id:"获取token"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#获取token"}},[t._v("#")]),t._v(" 获取token")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl -n kubernetes-dashboard describe secret $(kubectl -n kubernetes-dashboard get secret | grep admin-user | awk '{print $1}')")]),t._v("\n")])])]),s("p",[t._v("输出如下")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("Name:         admin-user-token-62n7k\nNamespace:    kubernetes-dashboard\nLabels:       "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nAnnotations:  kubernetes.io/service-account.name: admin-user\n              kubernetes.io/service-account.uid: c5974a9e-3e40-4cf0-bf55-414293a39de3\n\nType:  kubernetes.io/service-account-token\n\nData\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v("\nca.crt:     "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1025")]),t._v(" bytes\nnamespace:  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" bytes\ntoken:      eyJhbGciOiJSUzI1NiIsImtpZCI6IjcyRGtNcmY5YW50TjYxRjZDZ0R3VmxLdldDNlRRRjFEcnVxQndKRW04YzgifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJhZG1pbi11c2VyLXRva2VuLTYybjdrIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImFkbWluLXVzZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiJjNTk3NGE5ZS0zZTQwLTRjZjAtYmY1NS00MTQyOTNhMzlkZTMiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZXJuZXRlcy1kYXNoYm9hcmQ6YWRtaW4tdXNlciJ9.ExrfCmoCGqRXIrhOnNnSZE6to56TDJJxvarVpje6SphMeIQE2eSFtgsPWxAAwHROWX86kOjx82X_M-pRxFfBVeAJEmgjBiNsunEQ86dDMQLbbqmUX5TINNpk4Xhc7xOtnlP7JmHFoOYibTCH1BUC3BvFmCbFm2q7y2_MERDyIHL2B0aFe8MGhVRlLBmf0qTYQr11JZWL9JSI9037gG_rXdJpdDZFrvAygJ6P-klqw5BHDA8EWu4s7qrPODVqwTBi_7sHgmQ0qRLU7gJOJy0Xha9e12yINoVKx_F8dAQH-YfEXqyAhtcbAfPZnk9JVCI3uGuEhnDpoAyX9X7vSt8gKA\n")])])]),s("h3",{attrs:{id:"访问方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#访问方式"}},[t._v("#")]),t._v(" 访问方式")]),t._v(" "),s("p",[t._v("这里我们使用API Server方式访问Dashboard，对于API Server来说，它是使用证书进行认证的，我们需要先创建一个证书")]),t._v(" "),s("ul",[s("li",[t._v("创建.kube文件夹并把admin.conf复制到此文件夹"),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mkdir -p $HOME/.kube")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config")]),t._v("\n")])])])]),t._v(" "),s("li",[t._v("生成client-certificate-data"),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# grep 'client-certificate-data' ~/.kube/config | head -n 1 | awk '{print $2}' | base64 -d >> kubecfg.crt")]),t._v("\n")])])])]),t._v(" "),s("li",[t._v("生成client-key-data"),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# grep 'client-key-data' ~/.kube/config | head -n 1 | awk '{print $2}' | base64 -d >> kubecfg.key")]),t._v("\n")])])])]),t._v(" "),s("li",[t._v("生成p12"),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# openssl pkcs12 -export -clcerts -inkey kubecfg.key -in kubecfg.crt -out kubecfg.p12 -name "kubernetes-client"')]),t._v("\n")])])]),s("strong",[t._v("这里会提示输入密码，这个密码是证书导入浏览器要输入的密码")])])]),t._v(" "),s("p",[t._v("修改service/kubernetes-dashboard类型为NodePort")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@localhost ~"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# kubectl edit svc kubernetes-dashboard -n kubernetes-dashboard")]),t._v("\n")])])]),s("p",[t._v("浏览器导入kubecfg.p12，Dashboard入口url地址"),s("code",[t._v("https://192.168.0.1:6443/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/#/login")])])])}),[],!1,null,null,null);a.default=n.exports}}]);