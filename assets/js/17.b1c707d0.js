(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{400:function(t,s,a){t.exports=a.p+"assets/img/related.18971cde.png"},464:function(t,s,a){"use strict";a.r(s);var n=a(54),r=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h2",{attrs:{id:"入门指南"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#入门指南"}},[t._v("#")]),t._v(" 入门指南")]),t._v(" "),n("h3",{attrs:{id:"声明模型"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#声明模型"}},[t._v("#")]),t._v(" 声明模型")]),t._v(" "),n("div",{staticClass:"language-go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" Cluster "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  global"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ARSDN_MODEL\n  Name         "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("`gorm:\"not null;unique;comment:'集群名称'\"`")]),t._v("\n  CType        "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("`gorm:\"type:enum('master','slave');default:'master';comment:'主从类型'\"`")]),t._v("\n  MasterIp     "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("`gorm:\"comment:'主集群IP'\"`")]),t._v("\n  MasterPort   "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint")]),t._v("        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("`gorm:\"comment:'主集群Port'\"`")]),t._v("\n  MasterPass   "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("`gorm:\"type:varchar(2000);comment:'主集群密码'\"`")]),t._v("\n  Desc         "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("`gorm:\"comment:'集群描述'\"`")]),t._v("\n  SdnVersion   "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("`gorm:\"type:enum('arSdn_3.1', 'arSdn_3.2');comment:'SDN版本'\"`")]),t._v("\n  BackendType  "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("`gorm:\"type:enum('KVM','VMware');comment:'后端集群类型'\"`")]),t._v("\n  BackendIp    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("`gorm:\"not null;unique;comment:'后端集群IP'\"`")]),t._v("\n  BackendPort  "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint")]),t._v("        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("`gorm:\"not null;comment:'后端集群端口'\"`")]),t._v("\n  BackendUser  "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("`gorm:\"comment:'VMware账号'\"`")]),t._v("\n  BackendPass  "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("`gorm:\"comment:'VMware密码'\"`")]),t._v("\n  Network      Networks    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("`gorm:\"not null;type:json;comment:'网络'\"`")]),t._v("\n  Sdn          SDN         "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("`gorm:\"not null;type:json;comment:'SDN参数'\"`")]),t._v("\n  Status       "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),t._v("         "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("`gorm:\"not null;comment:'集群状态'\"`")]),t._v("\n  Hosts        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("HostModel "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("`gorm:\"constraint:OnDelete:CASCADE;comment:'主机'\"`")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[n("code",[t._v("Networks")]),t._v("、"),n("code",[t._v("SDN")]),t._v("是自定义数据类型，详情见自定义数据类型章节")]),t._v(" "),n("h3",{attrs:{id:"连接到数据库"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#连接到数据库"}},[t._v("#")]),t._v(" 连接到数据库")]),t._v(" "),n("p",[t._v("GORM 官方支持的数据库类型有：MySQL, PostgreSQL, SQlite, SQL Server")]),t._v(" "),n("h4",{attrs:{id:"mysql"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mysql"}},[t._v("#")]),t._v(" MySQL")]),t._v(" "),n("div",{staticClass:"language-go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"gorm.io/driver/mysql"')]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"gorm.io/gorm"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 不建立外键")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("gormConfig")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("gorm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Config "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  config "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("gorm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Config"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("DisableForeignKeyConstraintWhenMigrating"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" config\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("GormMysql")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("gorm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DB "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  dsn "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"root:huayun2021@tcp(127.0.0.1:3306)/dbname?charset=utf8mb4&parseTime=True&loc=Local"')]),t._v("\n  mysqlConfig "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Config"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    DSN"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("                       dsn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// DSN data source name")]),t._v("\n    DefaultStringSize"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("         "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("256")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// string 类型字段的默认长度")]),t._v("\n    DisableDatetimePrecision"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 禁用 datetime 精度，MySQL 5.6 之前的数据库不支持")]),t._v("\n    DontSupportRenameIndex"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 重命名索引时采用删除并新建的方式，MySQL 5.7 之前的数据库和 MariaDB 不支持重命名索引")]),t._v("\n    DontSupportRenameColumn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 用 `change` 重命名列，MySQL 8 之前的数据库和 MariaDB 不支持重命名列")]),t._v("\n    SkipInitializeWithVersion"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 根据版本自动配置")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" db"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" gorm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Open")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mysql"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("New")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mysqlConfig"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("gormConfig")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" err "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    log"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Println")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mysql connect fail"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" db\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h2",{attrs:{id:"crud"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#crud"}},[t._v("#")]),t._v(" CRUD")]),t._v(" "),n("h3",{attrs:{id:"创建"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建"}},[t._v("#")]),t._v(" 创建")]),t._v(" "),n("div",{staticClass:"language-go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[t._v("user "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" User"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("Name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Jinzhu"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Age"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Birthday"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Now")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nresult "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" db"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Create")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("user"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 通过数据的指针来创建")]),t._v("\n\nuser"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ID             "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 返回插入数据的主键")]),t._v("\nresult"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Error        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 返回 error")]),t._v("\nresult"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("RowsAffected "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 返回插入记录的条数")]),t._v("\n")])])]),n("h3",{attrs:{id:"查询"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查询"}},[t._v("#")]),t._v(" 查询")]),t._v(" "),n("h4",{attrs:{id:"检索单个对象"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#检索单个对象"}},[t._v("#")]),t._v(" 检索单个对象")]),t._v(" "),n("p",[t._v("GORM 提供了"),n("code",[t._v("First")]),t._v("、"),n("code",[t._v("Take")]),t._v("、"),n("code",[t._v("Last")]),t._v("方法，以便从数据库中检索单个对象。当查询数据库时它添加了"),n("code",[t._v("LIMIT 1")]),t._v("条件，且没有找到记录时，它会返回"),n("code",[t._v("ErrRecordNotFound")]),t._v("错误")]),t._v(" "),n("div",{staticClass:"language-go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 获取第一条记录（主键升序）")]),t._v("\ndb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("First")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("user"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// SELECT * FROM users ORDER BY id LIMIT 1;")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 获取一条记录，没有指定排序字段")]),t._v("\ndb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Take")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("user"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// SELECT * FROM users LIMIT 1;")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 获取最后一条记录（主键降序）")]),t._v("\ndb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Last")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("user"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// SELECT * FROM users ORDER BY id DESC LIMIT 1;")]),t._v("\n\nresult "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" db"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("First")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("user"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nresult"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("RowsAffected "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 返回找到的记录数")]),t._v("\nresult"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Error        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// returns error or nil")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 检查 ErrRecordNotFound 错误")]),t._v("\nerrors"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Is")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("result"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" gorm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ErrRecordNotFound"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("h4",{attrs:{id:"检索全部对象"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#检索全部对象"}},[t._v("#")]),t._v(" 检索全部对象")]),t._v(" "),n("div",{staticClass:"language-go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 获取全部记录")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" users "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("User\nresult "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" db"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Find")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("users"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// SELECT * FROM users;")]),t._v("\n\nresult"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("RowsAffected "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 返回找到的记录数，相当于 `len(users)`")]),t._v("\nresult"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Error        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// returns error")]),t._v("\n")])])]),n("h3",{attrs:{id:"更新"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#更新"}},[t._v("#")]),t._v(" 更新")]),t._v(" "),n("div",{staticClass:"language-go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[t._v("db"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Model")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("Email"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Where")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"id = ?"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Update")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"email"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"plsof@qq.com"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("h3",{attrs:{id:"删除"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#删除"}},[t._v("#")]),t._v(" 删除")]),t._v(" "),n("div",{staticClass:"language-go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[t._v("db"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Where")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name = ?"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pdd"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Delete")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("email"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// DELETE from emails where id = 10 AND name = "pdd";')]),t._v("\n")])])]),n("h4",{attrs:{id:"软删除"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#软删除"}},[t._v("#")]),t._v(" 软删除")]),t._v(" "),n("p",[t._v("如果你的模型里面包含"),n("code",[t._v("gorm.DeleteAt")]),t._v("（"),n("code",[t._v("gorm.Model")]),t._v("提供）字段，会执行软删除。")]),t._v(" "),n("p",[t._v("记录不会被删除，而是把"),n("code",[t._v("DeleteAt")]),t._v("字段设置为当前时间，Query请求的时候不会显示出这个字段。")]),t._v(" "),n("p",[n("code",[t._v("Unscoped")]),t._v("会执行物理的删除")]),t._v(" "),n("div",{staticClass:"language-go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[t._v("db"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Unscoped")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Delete")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("order"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// DELETE FROM orders WHERE id=10;")]),t._v("\n")])])]),n("h4",{attrs:{id:"阻止全局删除"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#阻止全局删除"}},[t._v("#")]),t._v(" 阻止全局删除")]),t._v(" "),n("p",[t._v("如果在没有任何条件的情况下执行批量删除，GORM 不会执行该操作，并返回 ErrMissingWhereClause 错误")]),t._v(" "),n("p",[t._v("对此，你必须加一些条件，或者使用原生 SQL，或者启用 AllowGlobalUpdate 模式，例如：")]),t._v(" "),n("div",{staticClass:"language-go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[t._v("db"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Delete")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("User"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Error "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// gorm.ErrMissingWhereClause")]),t._v("\n\ndb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Where")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1 = 1"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Delete")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("User"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// DELETE FROM `users` WHERE 1=1")]),t._v("\n\ndb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Exec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"DELETE FROM users"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// DELETE FROM users")]),t._v("\n\ndb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Session")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("gorm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Session"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("AllowGlobalUpdate"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Delete")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("User"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// DELETE FROM users")]),t._v("\n")])])]),n("h2",{attrs:{id:"关联"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#关联"}},[t._v("#")]),t._v(" 关联")]),t._v(" "),n("h3",{attrs:{id:"belongs-to"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#belongs-to"}},[t._v("#")]),t._v(" Belongs to")]),t._v(" "),n("p",[n("code",[t._v("belongs to")]),t._v("会与另一个模型建立了一对一的连接。这种模型的每一个实例都“属于”另一个模型的一个实例。")]),t._v(" "),n("p",[t._v("例如，您的应用包含 cluster 和 host，并且每个 host 能且只能被分配给一个 cluster。下面的类型就表示这种关系。注意，在"),n("code",[t._v("Host")]),t._v("对象中，有一个和"),n("code",[t._v("Cluster")]),t._v("一样的ClusterID。默认情况下，"),n("code",[t._v("ClusterID")]),t._v("被隐含地用来在"),n("code",[t._v("Host")]),t._v("和"),n("code",[t._v("Cluster")]),t._v("之间创建一个外键关系，因此必须包含在"),n("code",[t._v("Host")]),t._v("结构体中才能填充"),n("code",[t._v("Cluster")]),t._v("内部结构体。")]),t._v(" "),n("div",{staticClass:"language-go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Host 属于 Cluster，ClusterID是外键")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" Host "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  gorm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Model\n  HostName  "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gorm:"column:hostname;not null;unique"`')]),t._v("\n  SshIp     "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gorm:"not null;unique"`')]),t._v("\n  ClusterID "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 外键")]),t._v("\n  Cluster   Cluster\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" Cluster "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  gorm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Model\n  Name  "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gorm:"not null;unique"`')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h3",{attrs:{id:"has-one"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#has-one"}},[t._v("#")]),t._v(" Has One")]),t._v(" "),n("p",[n("code",[t._v("has one")]),t._v("与另一个模型建立一对一的关联，但它和一对一关系有些许不同。这种关联表明一个模型的每个实例都包含或拥有另一个模型的一个实例。")]),t._v(" "),n("p",[t._v("例如，您的应用包含 cluster 和 host 模型，且每个 cluster 只能有一个 host。")]),t._v(" "),n("div",{staticClass:"language-go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Cluster有一个Host，ClusterID是外键")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" Cluster "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  gorm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Model\n  Name  "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gorm:"not null;unique"`')]),t._v("\n  Host  Host    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gorm:"constraint:OnDelete:CASCADE"`')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" Host "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  gorm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Model\n  ClusterID "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 外键")]),t._v("\n  HostName  "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gorm:"column:hostname;not null;unique"`')]),t._v("\n  SshIp     "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gorm:"not null;unique"`')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h3",{attrs:{id:"has-many"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#has-many"}},[t._v("#")]),t._v(" Has Many")]),t._v(" "),n("p",[n("code",[t._v("has many")]),t._v("与另一个模型建立了一对多的连接。不同于"),n("code",[t._v("has one")]),t._v("，拥有者可以有零或多个关联模型。")]),t._v(" "),n("p",[t._v("例如，您的应用包含cluster和host模型，且每个cluster可以有多个host。")]),t._v(" "),n("div",{staticClass:"language-go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Cluster有多个Host，ClusterID是外键")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" Cluster "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  gorm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Model\n  Name  "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gorm:"not null;unique"`')]),t._v("\n  Hosts "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("Host  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gorm:"constraint:OnDelete:CASCADE"`')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" Host "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  gorm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Model\n  ClusterID "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 外键")]),t._v("\n  HostName  "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gorm:"column:hostname;not null;unique"`')]),t._v("\n  SshIp     "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gorm:"not null;unique"`')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h3",{attrs:{id:"many-to-many"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#many-to-many"}},[t._v("#")]),t._v(" Many To Many")]),t._v(" "),n("p",[t._v("Example:")]),t._v(" "),n("ol",[n("li",[t._v("数据结构")])]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("表1")]),t._v(" "),n("th",[t._v("表2")]),t._v(" "),n("th",[t._v("关联关系")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("user")]),t._v(" "),n("td",[t._v("address")]),t._v(" "),n("td",[t._v("belongs_to")])]),t._v(" "),n("tr",[n("td",[t._v("user")]),t._v(" "),n("td",[t._v("email")]),t._v(" "),n("td",[t._v("has_many")])]),t._v(" "),n("tr",[n("td",[t._v("user")]),t._v(" "),n("td",[t._v("creditcard")]),t._v(" "),n("td",[t._v("has_one")])]),t._v(" "),n("tr",[n("td",[t._v("user")]),t._v(" "),n("td",[t._v("languages")]),t._v(" "),n("td",[t._v("many_to_many")])])])]),t._v(" "),n("img",{staticStyle:{zoom:"85%"},attrs:{src:a(400),alt:"gorm"}}),t._v(" "),n("ol",{attrs:{start:"2"}},[n("li",[t._v("代码")])]),t._v(" "),n("div",{staticClass:"language-go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" main\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fmt"')]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/jinzhu/gorm"')]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("_")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/jinzhu/gorm/dialects/mysql"')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" User "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  ID                "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint")]),t._v("       "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gorm:"primary_key"`')]),t._v("\n  Birthday          "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("     "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gorm:"column:birthday"`')]),t._v("\n  Age               "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),t._v("        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gorm:"column:age"`')]),t._v("\n  Name              "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("     "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gorm:"column:name"`')]),t._v("\n  BillingAddress    Address    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gorm:"foreignkey:BillingAddressId;"`')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// One-To-One (属于 - 本表的BillingAddressID作外键")]),t._v("\n  BillingAddressId  "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),t._v("        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gorm:"column:billing_address_id"`')]),t._v("\n  ShippingAddress   Address    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gorm:"foreignkey:ShippingAddressId;"`')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// One-To-One (属于 - 本表的ShippingAddressID作外键)")]),t._v("\n  ShippingAddressId "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),t._v("        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gorm:"column:shipping_address_id"`')]),t._v("\n  CreditCard        CreditCard "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gorm:"foreignkey:UserID;"`')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// One-To-One (拥有一个 - CreditCard表的UserID作外键)")]),t._v("\n  Emails            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("Email    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gorm:"ForeignKey:UserID;"`')]),t._v("            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// One-To-Many (拥有多个 - Email表的UserID作外键)")]),t._v("\n  Languages         "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("Language "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gorm:"many2many:user_languages;"`')]),t._v("     "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Many-To-Many , 'user_languages'是连接表")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" Email "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  ID     "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gorm:"primary_key"`')]),t._v("\n  UserID "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gorm:"column:user_id;"`')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 外键 (属于), tag `index`是为该列创建索引")]),t._v("\n  Email  "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gorm:"column:email"`')]),t._v("    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// `type`设置sql类型, `unique_index` 为该列设置唯一索引")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" Address "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  ID       "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gorm:"primary_key"`')]),t._v("\n  Address1 "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gorm:"column:address1"`')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 设置字段为非空并唯一")]),t._v("\n  Address2 "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gorm:"column:address2"`')]),t._v("\n  Post     "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gorm:"column:post"`')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" Language "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  ID   "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gorm:"primary_key"`')]),t._v("\n  Name "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gorm:"column:name"`')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建索引并命名，如果找到其他相同名称的索引则创建组合索引")]),t._v("\n  Code "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gorm:"column:code"`')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// `unique_index` also works")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" CreditCard "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  ID     "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gorm:"primary_key"`')]),t._v("\n  UserID "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gorm:"column:user_id;"`')]),t._v("\n  Number "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gorm:"column:number"`')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  db"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" gorm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Open")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mysql"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"root:21ysten123@(127.0.0.1)/gorm?charset=utf8&parseTime=True&loc=Local"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("panic")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("defer")]),t._v(" db"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Close")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  db"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("AutoMigrate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("User"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    Email"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    Address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    Language"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    CreditCard"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" creditCard1 CreditCard\n  creditCard1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ID "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  creditCard1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("UserID "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1001")]),t._v("\n  creditCard1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Number "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1001PDD"')]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" creditCard2 CreditCard\n  creditCard2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ID "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n  creditCard2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("UserID "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1002")]),t._v("\n  creditCard2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Number "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1002PXX"')]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" language1 Language\n  language1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ID "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  language1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Name "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"english"')]),t._v("\n  language1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Code "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"101ENG"')]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" language2 Language\n  language2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ID "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n  language2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Name "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"chinese"')]),t._v("\n  language2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Code "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"102CHI"')]),t._v("\n\n  languages "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("Language"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  languages"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" language1\n  languages"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" language2\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" address Address\n  address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ID "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Address1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"扬州市"')]),t._v("\n  address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Address2 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"无锡市"')]),t._v("\n  address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Post "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"214000"')]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" email1 Email\n  email1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ID "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  email1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("UserID "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),t._v("\n  email1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Email "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"254995740@qq.com"')]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" email2 Email\n  email2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ID "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n  email2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("UserID "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v("\n  email2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Email "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1103901630@qq.com"')]),t._v("\n\n  oEmails1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("Email"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  oEmails1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" email1\n\n  oEmails2 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("Email"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  oEmails2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" email2\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" user1 User\n  user1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ID "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  user1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Birthday "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1029"')]),t._v("\n  user1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Age "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v("\n  user1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Name "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pdd"')]),t._v("\n  user1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("BillingAddress "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" address\n  user1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("BillingAddressId "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  user1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ShippingAddress "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" address\n  user1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ShippingAddressId "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n  user1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CreditCard "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" creditCard1\n  user1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Emails "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" oEmails1\n  user1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Languages "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" languages\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" user2 User\n  user2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ID "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n  user2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Birthday "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1030"')]),t._v("\n  user2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Age "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v("\n  user2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Name "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pxx"')]),t._v("\n  user2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("BillingAddress "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" address\n  user2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("BillingAddressId "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n  user2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ShippingAddress "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" address\n  user2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ShippingAddressId "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n  user2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CreditCard "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" creditCard2\n  user2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Emails "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" oEmails2\n  user2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Languages "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" languages\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//插入数据")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//db.Create(&creditCard1)")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//db.Create(&creditCard2)")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//db.Create(&language1)")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//db.Create(&language2)")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//db.Create(&address)")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//db.Create(&email1)")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//db.Create(&email2)")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//db.Create(&user1)")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//db.Create(&user2)")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//删除数据")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//db.Delete(&user)")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//查询")]),t._v("\n  u "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" User"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("ID"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  db"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Model")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("u"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Debug")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Find")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("u"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  db"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Model")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("u"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Debug")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Related")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("u"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CreditCard"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"CreditCard"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  db"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Model")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("u"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Debug")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Related")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("u"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Emails"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Emails"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  db"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Model")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("u"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Debug")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Related")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("u"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Languages"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Languages"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  db"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Model")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("u"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Debug")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Related")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("u"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("BillingAddress"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"BillingAddress"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  db"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Model")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("u"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Debug")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Related")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("u"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ShippingAddress"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ShippingAddress"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  fmt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Println")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("u"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("div",{staticClass:"language-go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1029")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v(" pdd "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" 扬州市 无锡市 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("214000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" 扬州市 无锡市 "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("214000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1001")]),t._v("PDD"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("254995740")]),t._v("@qq"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" english "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("101")]),t._v("ENG"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" chinese "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("102")]),t._v("CHI"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h3",{attrs:{id:"预加载"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#预加载"}},[t._v("#")]),t._v(" 预加载")]),t._v(" "),n("p",[t._v("GORM 允许在 Preload 的其它 SQL 中直接加载关系，例如：")]),t._v(" "),n("div",{staticClass:"language-go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Cluster有多个Host，ClusterID是外键")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" Cluster "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  gorm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Model\n  Name  "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gorm:"not null;unique"`')]),t._v("\n  Hosts "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("Host  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gorm:"constraint:OnDelete:CASCADE"`')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" Host "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  gorm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Model\n  ClusterID "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 外键")]),t._v("\n  HostName  "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gorm:"column:hostname;not null;unique"`')]),t._v("\n  SshIp     "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('`gorm:"not null;unique"`')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 查找 cluster 时预加载相关 host")]),t._v("\ndb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Preload")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Hosts"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Find")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("cluster"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// SELECT * FROM clusters;")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// SELECT * FROM hosts WHERE cluster_id = 1;")]),t._v("\n")])])]),n("h2",{attrs:{id:"自定义数据类型"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#自定义数据类型"}},[t._v("#")]),t._v(" 自定义数据类型")]),t._v(" "),n("p",[t._v("GORM 提供了少量接口，使用户能够为 GORM 定义支持的数据类型")]),t._v(" "),n("h3",{attrs:{id:"scanner-valuer"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#scanner-valuer"}},[t._v("#")]),t._v(" Scanner/Valuer")]),t._v(" "),n("p",[t._v("自定义的数据类型必须实现"),n("code",[t._v("Scanner")]),t._v("和"),n("code",[t._v("Valuer")]),t._v("接口，以便让 GORM 知道如何将该类型接收、保存到数据库")]),t._v(" "),n("div",{staticClass:"language-go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 网络")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// {")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//   "network": {')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//     "internal_network": {')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//       "net_start": "192.168.1.1",')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//       "net_end": "192.168.1.10",')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//       "prefix": 24')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//     },")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//     "management_network": {')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//       "net_start": "192.168.1.1",')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//       "net_end": "192.168.1.10",')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//       "prefix": 24')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//     },")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//   }")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// }")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" Networks "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("map")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("map")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("c Networks"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Value")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("driver"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" json"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Marshal")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("c"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("c "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("Networks"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Scan")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("input "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" json"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Unmarshal")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("input"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("byte")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" c"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// SDN")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// {")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//   internal_vlan_id: "",')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//   external_vlan_range: "",')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//   vroute_template: "",')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//   mirror_url: "",')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//   mirror_tag: "",')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//   arnet_vlan_range: "",')]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// }")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" SDN "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("map")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("c SDN"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Value")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("driver"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" json"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Marshal")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("c"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("c "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("SDN"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Scan")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("input "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" json"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Unmarshal")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("input"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("byte")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" c"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" Cluster "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  global"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ARSDN_MODEL\n  Name         "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("`gorm:\"not null;unique;comment:'集群名称'\"`")]),t._v("\n  CType        "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("`gorm:\"type:enum('master','slave');default:'master';comment:'主从类型'\"`")]),t._v("\n  MasterIp     "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("`gorm:\"comment:'主集群IP'\"`")]),t._v("\n  MasterPort   "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint")]),t._v("        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("`gorm:\"comment:'主集群Port'\"`")]),t._v("\n  MasterPass   "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("`gorm:\"type:varchar(2000);comment:'主集群密码'\"`")]),t._v("\n  Desc         "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("`gorm:\"comment:'集群描述'\"`")]),t._v("\n  SdnVersion   "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("`gorm:\"type:enum('arSdn_3.1', 'arSdn_3.2');comment:'SDN版本'\"`")]),t._v("\n  BackendType  "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("`gorm:\"type:enum('KVM','VMware');comment:'后端集群类型'\"`")]),t._v("\n  BackendIp    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("`gorm:\"not null;unique;comment:'后端集群IP'\"`")]),t._v("\n  BackendPort  "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint")]),t._v("        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("`gorm:\"not null;comment:'后端集群端口'\"`")]),t._v("\n  BackendUser  "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("`gorm:\"comment:'VMware账号'\"`")]),t._v("\n  BackendPass  "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("`gorm:\"comment:'VMware密码'\"`")]),t._v("\n  Network      Networks    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("`gorm:\"not null;type:json;comment:'网络'\"`")]),t._v("\n  Sdn          SDN         "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("`gorm:\"not null;type:json;comment:'SDN参数'\"`")]),t._v("\n  Status       "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),t._v("         "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("`gorm:\"not null;comment:'集群状态'\"`")]),t._v("\n  Hosts        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("HostModel "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("`gorm:\"constraint:OnDelete:CASCADE;comment:'主机'\"`")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=r.exports}}]);