<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Docker | plsof</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/blog/assets/img/favicon.ico">
    <meta name="description" content="Vuepress blog">
    
    <link rel="preload" href="/blog/assets/css/0.styles.dab10465.css" as="style"><link rel="preload" href="/blog/assets/js/app.88086388.js" as="script"><link rel="preload" href="/blog/assets/js/2.49a236d9.js" as="script"><link rel="preload" href="/blog/assets/js/23.7b46bea8.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.2757765f.js"><link rel="prefetch" href="/blog/assets/js/11.5839dede.js"><link rel="prefetch" href="/blog/assets/js/12.a8947560.js"><link rel="prefetch" href="/blog/assets/js/13.a0ba02e9.js"><link rel="prefetch" href="/blog/assets/js/14.e2f92b4b.js"><link rel="prefetch" href="/blog/assets/js/15.b48fa565.js"><link rel="prefetch" href="/blog/assets/js/16.b81700c6.js"><link rel="prefetch" href="/blog/assets/js/17.b1c707d0.js"><link rel="prefetch" href="/blog/assets/js/18.5eef7a22.js"><link rel="prefetch" href="/blog/assets/js/19.520437c4.js"><link rel="prefetch" href="/blog/assets/js/20.d9d202f0.js"><link rel="prefetch" href="/blog/assets/js/21.cb138f89.js"><link rel="prefetch" href="/blog/assets/js/22.9785cf36.js"><link rel="prefetch" href="/blog/assets/js/24.4d3fedb1.js"><link rel="prefetch" href="/blog/assets/js/25.886bae34.js"><link rel="prefetch" href="/blog/assets/js/26.ed77c345.js"><link rel="prefetch" href="/blog/assets/js/27.bdbc11e8.js"><link rel="prefetch" href="/blog/assets/js/28.e10fadf3.js"><link rel="prefetch" href="/blog/assets/js/29.dda59d92.js"><link rel="prefetch" href="/blog/assets/js/3.f658113e.js"><link rel="prefetch" href="/blog/assets/js/30.d689903e.js"><link rel="prefetch" href="/blog/assets/js/31.aef48960.js"><link rel="prefetch" href="/blog/assets/js/32.12d3d2fc.js"><link rel="prefetch" href="/blog/assets/js/33.4cc9b4d7.js"><link rel="prefetch" href="/blog/assets/js/34.e2e313b7.js"><link rel="prefetch" href="/blog/assets/js/35.c5b27b66.js"><link rel="prefetch" href="/blog/assets/js/36.c5c32567.js"><link rel="prefetch" href="/blog/assets/js/37.dbdaccf3.js"><link rel="prefetch" href="/blog/assets/js/38.d63f78f3.js"><link rel="prefetch" href="/blog/assets/js/39.c09e93e4.js"><link rel="prefetch" href="/blog/assets/js/4.95d7177c.js"><link rel="prefetch" href="/blog/assets/js/40.d21e0571.js"><link rel="prefetch" href="/blog/assets/js/41.308ba400.js"><link rel="prefetch" href="/blog/assets/js/42.7a51c716.js"><link rel="prefetch" href="/blog/assets/js/43.7d849dfb.js"><link rel="prefetch" href="/blog/assets/js/44.9242de2f.js"><link rel="prefetch" href="/blog/assets/js/45.c5b4a02c.js"><link rel="prefetch" href="/blog/assets/js/46.57f62cd6.js"><link rel="prefetch" href="/blog/assets/js/47.d8881a46.js"><link rel="prefetch" href="/blog/assets/js/48.a8ce35d6.js"><link rel="prefetch" href="/blog/assets/js/49.cfb56ea8.js"><link rel="prefetch" href="/blog/assets/js/5.b4edcf13.js"><link rel="prefetch" href="/blog/assets/js/50.5102c797.js"><link rel="prefetch" href="/blog/assets/js/51.985f331b.js"><link rel="prefetch" href="/blog/assets/js/52.2c5b2d65.js"><link rel="prefetch" href="/blog/assets/js/53.91ad6526.js"><link rel="prefetch" href="/blog/assets/js/54.df415473.js"><link rel="prefetch" href="/blog/assets/js/55.6597a04e.js"><link rel="prefetch" href="/blog/assets/js/56.f09e9bf7.js"><link rel="prefetch" href="/blog/assets/js/57.73dec97d.js"><link rel="prefetch" href="/blog/assets/js/58.6c6da79c.js"><link rel="prefetch" href="/blog/assets/js/59.129c9d37.js"><link rel="prefetch" href="/blog/assets/js/6.b73564f2.js"><link rel="prefetch" href="/blog/assets/js/60.c3e19ee6.js"><link rel="prefetch" href="/blog/assets/js/61.99a0272f.js"><link rel="prefetch" href="/blog/assets/js/62.8e7648bc.js"><link rel="prefetch" href="/blog/assets/js/63.bc3cac30.js"><link rel="prefetch" href="/blog/assets/js/64.b112247d.js"><link rel="prefetch" href="/blog/assets/js/65.071e002b.js"><link rel="prefetch" href="/blog/assets/js/66.006dc1f0.js"><link rel="prefetch" href="/blog/assets/js/67.a2b507c8.js"><link rel="prefetch" href="/blog/assets/js/68.b0d7cf22.js"><link rel="prefetch" href="/blog/assets/js/69.4ee86054.js"><link rel="prefetch" href="/blog/assets/js/7.50844ffb.js"><link rel="prefetch" href="/blog/assets/js/70.dc7beda1.js"><link rel="prefetch" href="/blog/assets/js/71.ce7db99a.js"><link rel="prefetch" href="/blog/assets/js/72.047b9fa4.js"><link rel="prefetch" href="/blog/assets/js/73.9d07e8c8.js"><link rel="prefetch" href="/blog/assets/js/74.53e33484.js"><link rel="prefetch" href="/blog/assets/js/75.231d43d3.js"><link rel="prefetch" href="/blog/assets/js/8.fad53de1.js"><link rel="prefetch" href="/blog/assets/js/9.1f23426f.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.dab10465.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/assets/img/sheep.png" alt="plsof" class="logo"> <span class="site-name can-hide">plsof</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Linux" class="dropdown-title"><span class="title">Linux</span> <span class="arrow down"></span></button> <button type="button" aria-label="Linux" class="mobile-dropdown-title"><span class="title">Linux</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/note/linux/awk.html" class="nav-link">
  awk
</a></li><li class="dropdown-item"><!----> <a href="/blog/note/linux/date.html" class="nav-link">
  date
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Python" class="dropdown-title"><span class="title">Python</span> <span class="arrow down"></span></button> <button type="button" aria-label="Python" class="mobile-dropdown-title"><span class="title">Python</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/note/python/datatypes/" class="nav-link">
  数据类型
</a></li><li class="dropdown-item"><!----> <a href="/blog/note/python/function/" class="nav-link">
  函数
</a></li><li class="dropdown-item"><!----> <a href="/blog/note/python/oop/" class="nav-link">
  面向对象
</a></li><li class="dropdown-item"><!----> <a href="/blog/note/python/log/" class="nav-link">
  日志
</a></li><li class="dropdown-item"><!----> <a href="/blog/note/python/network/" class="nav-link">
  网络
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Golang" class="dropdown-title"><span class="title">Golang</span> <span class="arrow down"></span></button> <button type="button" aria-label="Golang" class="mobile-dropdown-title"><span class="title">Golang</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/note/go/basic/" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/blog/note/go/gin/" class="nav-link">
  gin
</a></li><li class="dropdown-item"><!----> <a href="/blog/note/go/gorm/" class="nav-link">
  gorm
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/note/frontend/css/" class="nav-link">
  css
</a></li><li class="dropdown-item"><!----> <a href="/blog/note/frontend/js/" class="nav-link">
  js
</a></li><li class="dropdown-item"><!----> <a href="/blog/note/frontend/vue/" class="nav-link">
  vue
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/note/db/etcd/" class="nav-link">
  etcd
</a></li><li class="dropdown-item"><!----> <a href="/blog/note/db/redis/" class="nav-link">
  redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="云原生" class="dropdown-title"><span class="title">云原生</span> <span class="arrow down"></span></button> <button type="button" aria-label="云原生" class="mobile-dropdown-title"><span class="title">云原生</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/note/cloud-native/docker/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  docker
</a></li><li class="dropdown-item"><!----> <a href="/blog/note/cloud-native/docker-compose/" class="nav-link">
  docker-compose
</a></li><li class="dropdown-item"><!----> <a href="/blog/note/cloud-native/kubernetes/" class="nav-link">
  kubernetes
</a></li><li class="dropdown-item"><!----> <a href="/blog/note/cloud-native/harbor/" class="nav-link">
  harbor
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="监控" class="dropdown-title"><span class="title">监控</span> <span class="arrow down"></span></button> <button type="button" aria-label="监控" class="mobile-dropdown-title"><span class="title">监控</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/note/monitor/prometheus/" class="nav-link">
  prometheus
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="配置管理" class="dropdown-title"><span class="title">配置管理</span> <span class="arrow down"></span></button> <button type="button" aria-label="配置管理" class="mobile-dropdown-title"><span class="title">配置管理</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/note/configuration-management/confd/" class="nav-link">
  confd
</a></li><li class="dropdown-item"><!----> <a href="/blog/note/configuration-management/saltstack/" class="nav-link">
  saltstack
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/plsof" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Linux" class="dropdown-title"><span class="title">Linux</span> <span class="arrow down"></span></button> <button type="button" aria-label="Linux" class="mobile-dropdown-title"><span class="title">Linux</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/note/linux/awk.html" class="nav-link">
  awk
</a></li><li class="dropdown-item"><!----> <a href="/blog/note/linux/date.html" class="nav-link">
  date
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Python" class="dropdown-title"><span class="title">Python</span> <span class="arrow down"></span></button> <button type="button" aria-label="Python" class="mobile-dropdown-title"><span class="title">Python</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/note/python/datatypes/" class="nav-link">
  数据类型
</a></li><li class="dropdown-item"><!----> <a href="/blog/note/python/function/" class="nav-link">
  函数
</a></li><li class="dropdown-item"><!----> <a href="/blog/note/python/oop/" class="nav-link">
  面向对象
</a></li><li class="dropdown-item"><!----> <a href="/blog/note/python/log/" class="nav-link">
  日志
</a></li><li class="dropdown-item"><!----> <a href="/blog/note/python/network/" class="nav-link">
  网络
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Golang" class="dropdown-title"><span class="title">Golang</span> <span class="arrow down"></span></button> <button type="button" aria-label="Golang" class="mobile-dropdown-title"><span class="title">Golang</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/note/go/basic/" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/blog/note/go/gin/" class="nav-link">
  gin
</a></li><li class="dropdown-item"><!----> <a href="/blog/note/go/gorm/" class="nav-link">
  gorm
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><span class="title">前端</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端" class="mobile-dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/note/frontend/css/" class="nav-link">
  css
</a></li><li class="dropdown-item"><!----> <a href="/blog/note/frontend/js/" class="nav-link">
  js
</a></li><li class="dropdown-item"><!----> <a href="/blog/note/frontend/vue/" class="nav-link">
  vue
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/note/db/etcd/" class="nav-link">
  etcd
</a></li><li class="dropdown-item"><!----> <a href="/blog/note/db/redis/" class="nav-link">
  redis
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="云原生" class="dropdown-title"><span class="title">云原生</span> <span class="arrow down"></span></button> <button type="button" aria-label="云原生" class="mobile-dropdown-title"><span class="title">云原生</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/note/cloud-native/docker/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  docker
</a></li><li class="dropdown-item"><!----> <a href="/blog/note/cloud-native/docker-compose/" class="nav-link">
  docker-compose
</a></li><li class="dropdown-item"><!----> <a href="/blog/note/cloud-native/kubernetes/" class="nav-link">
  kubernetes
</a></li><li class="dropdown-item"><!----> <a href="/blog/note/cloud-native/harbor/" class="nav-link">
  harbor
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="监控" class="dropdown-title"><span class="title">监控</span> <span class="arrow down"></span></button> <button type="button" aria-label="监控" class="mobile-dropdown-title"><span class="title">监控</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/note/monitor/prometheus/" class="nav-link">
  prometheus
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="配置管理" class="dropdown-title"><span class="title">配置管理</span> <span class="arrow down"></span></button> <button type="button" aria-label="配置管理" class="mobile-dropdown-title"><span class="title">配置管理</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/note/configuration-management/confd/" class="nav-link">
  confd
</a></li><li class="dropdown-item"><!----> <a href="/blog/note/configuration-management/saltstack/" class="nav-link">
  saltstack
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/plsof" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/blog/note/cloud-native/docker/" aria-current="page" class="active sidebar-link">Docker</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/note/cloud-native/docker/#简介" class="sidebar-link">简介</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/note/cloud-native/docker/#安装" class="sidebar-link">安装</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/note/cloud-native/docker/#镜像" class="sidebar-link">镜像</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/note/cloud-native/docker/#获取镜像" class="sidebar-link">获取镜像</a></li><li class="sidebar-sub-header"><a href="/blog/note/cloud-native/docker/#运行" class="sidebar-link">运行</a></li><li class="sidebar-sub-header"><a href="/blog/note/cloud-native/docker/#列出镜像" class="sidebar-link">列出镜像</a></li><li class="sidebar-sub-header"><a href="/blog/note/cloud-native/docker/#虚悬镜像" class="sidebar-link">虚悬镜像</a></li><li class="sidebar-sub-header"><a href="/blog/note/cloud-native/docker/#镜像构建最小化" class="sidebar-link">镜像构建最小化</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/note/cloud-native/docker/#网络" class="sidebar-link">网络</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/note/cloud-native/docker/#bridge网络模式" class="sidebar-link">Bridge网络模式</a></li><li class="sidebar-sub-header"><a href="/blog/note/cloud-native/docker/#host网络模式" class="sidebar-link">Host网络模式</a></li><li class="sidebar-sub-header"><a href="/blog/note/cloud-native/docker/#container网络模式" class="sidebar-link">Container网络模式</a></li><li class="sidebar-sub-header"><a href="/blog/note/cloud-native/docker/#none网络模式" class="sidebar-link">None网络模式</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/note/cloud-native/docker/#dockerfile" class="sidebar-link">Dockerfile</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/note/cloud-native/docker/#概述" class="sidebar-link">概述</a></li><li class="sidebar-sub-header"><a href="/blog/note/cloud-native/docker/#from" class="sidebar-link">FROM</a></li><li class="sidebar-sub-header"><a href="/blog/note/cloud-native/docker/#build" class="sidebar-link">BUILD</a></li><li class="sidebar-sub-header"><a href="/blog/note/cloud-native/docker/#copy" class="sidebar-link">COPY</a></li><li class="sidebar-sub-header"><a href="/blog/note/cloud-native/docker/#add" class="sidebar-link">ADD</a></li><li class="sidebar-sub-header"><a href="/blog/note/cloud-native/docker/#run" class="sidebar-link">RUN</a></li><li class="sidebar-sub-header"><a href="/blog/note/cloud-native/docker/#cmd" class="sidebar-link">CMD</a></li><li class="sidebar-sub-header"><a href="/blog/note/cloud-native/docker/#entrypoint" class="sidebar-link">ENTRYPOINT</a></li><li class="sidebar-sub-header"><a href="/blog/note/cloud-native/docker/#env" class="sidebar-link">ENV</a></li><li class="sidebar-sub-header"><a href="/blog/note/cloud-native/docker/#arg" class="sidebar-link">ARG</a></li><li class="sidebar-sub-header"><a href="/blog/note/cloud-native/docker/#volume" class="sidebar-link">VOLUME</a></li><li class="sidebar-sub-header"><a href="/blog/note/cloud-native/docker/#expose" class="sidebar-link">EXPOSE</a></li><li class="sidebar-sub-header"><a href="/blog/note/cloud-native/docker/#workdir" class="sidebar-link">WORKDIR</a></li><li class="sidebar-sub-header"><a href="/blog/note/cloud-native/docker/#user" class="sidebar-link">USER</a></li><li class="sidebar-sub-header"><a href="/blog/note/cloud-native/docker/#onbuild" class="sidebar-link">ONBUILD</a></li><li class="sidebar-sub-header"><a href="/blog/note/cloud-native/docker/#多阶段构建" class="sidebar-link">多阶段构建</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/note/cloud-native/docker/#容器" class="sidebar-link">容器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/note/cloud-native/docker/#启动" class="sidebar-link">启动</a></li><li class="sidebar-sub-header"><a href="/blog/note/cloud-native/docker/#日志" class="sidebar-link">日志</a></li><li class="sidebar-sub-header"><a href="/blog/note/cloud-native/docker/#终止" class="sidebar-link">终止</a></li><li class="sidebar-sub-header"><a href="/blog/note/cloud-native/docker/#进入" class="sidebar-link">进入</a></li><li class="sidebar-sub-header"><a href="/blog/note/cloud-native/docker/#删除" class="sidebar-link">删除</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/note/cloud-native/docker/#sdk" class="sidebar-link">SDK</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/note/cloud-native/docker/#go-sdk" class="sidebar-link">Go SDK</a></li></ul></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="简介"><a href="#简介" class="header-anchor">#</a> 简介</h2> <h3 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h3> <h2 id="镜像"><a href="#镜像" class="header-anchor">#</a> 镜像</h2> <h3 id="获取镜像"><a href="#获取镜像" class="header-anchor">#</a> 获取镜像</h3> <p><code>docker pull [选项] [Docker Registry 地址[:端口号]/]仓库名[:标签]</code></p> <ul><li>Docker 镜像仓库地址：地址的格式一般是 <code>&lt;域名/IP&gt;[:端口号]</code>。默认地址是 Docker Hub</li> <li>仓库名：如之前所说，这里的仓库名是两段式名称，即 <code>&lt;用户名&gt;/&lt;软件名&gt;</code>。对于 Docker Hub，如果不给出用户名，则默认为 <code>library</code>，也就是官方镜像。</li></ul> <ol><li>从官方仓库获取镜像</li></ol> <p><code>$ docker pull ubuntu:18.04</code></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token number">18.04</span>: Pulling from library/ubuntu
bf5d46315322: Pull complete
9f13e0ac480c: Pull complete
e8988b5b3097: Pull complete
40af181810e7: Pull complete
e6f7c7e5c03e: Pull complete
Digest: sha256:147913621d9cdea08853f6ba9116c2e27a3ceffecf3b492983ae97c3d643fbbe
Status: Downloaded newer image <span class="token keyword">for</span> ubuntu:18.04
</code></pre></div><ol start="2"><li>从私有仓库获取镜像</li></ol> <p><code>$ docker pull sc.yhub.ysten.com:9881/sichuan/vas/yst-vas-batch:1.0.0130_sichuan</code></p> <h3 id="运行"><a href="#运行" class="header-anchor">#</a> 运行</h3> <p>有了镜像后，我们就能够以这个镜像为基础启动并运行一个容器。</p> <p><code>$ docker run -it --rm ubuntu:18.04 bash</code></p> <div class="language-bash extra-class"><pre class="language-bash"><code>root@d786d31cbd76:/<span class="token comment"># cat /etc/os-release</span>
<span class="token assign-left variable">NAME</span><span class="token operator">=</span><span class="token string">&quot;Ubuntu&quot;</span>
<span class="token assign-left variable">VERSION</span><span class="token operator">=</span><span class="token string">&quot;18.04.2 LTS (Bionic Beaver)&quot;</span>
<span class="token assign-left variable">ID</span><span class="token operator">=</span>ubuntu
<span class="token assign-left variable">ID_LIKE</span><span class="token operator">=</span>debian
<span class="token assign-left variable">PRETTY_NAME</span><span class="token operator">=</span><span class="token string">&quot;Ubuntu 18.04.2 LTS&quot;</span>
<span class="token assign-left variable">VERSION_ID</span><span class="token operator">=</span><span class="token string">&quot;18.04&quot;</span>
<span class="token assign-left variable">HOME_URL</span><span class="token operator">=</span><span class="token string">&quot;https://www.ubuntu.com/&quot;</span>
<span class="token assign-left variable">SUPPORT_URL</span><span class="token operator">=</span><span class="token string">&quot;https://help.ubuntu.com/&quot;</span>
<span class="token assign-left variable">BUG_REPORT_URL</span><span class="token operator">=</span><span class="token string">&quot;https://bugs.launchpad.net/ubuntu/&quot;</span>
<span class="token assign-left variable">PRIVACY_POLICY_URL</span><span class="token operator">=</span><span class="token string">&quot;https://www.ubuntu.com/legal/terms-and-policies/privacy-policy&quot;</span>
<span class="token assign-left variable">VERSION_CODENAME</span><span class="token operator">=</span>bionic
<span class="token assign-left variable">UBUNTU_CODENAME</span><span class="token operator">=</span>bionic
</code></pre></div><h3 id="列出镜像"><a href="#列出镜像" class="header-anchor">#</a> 列出镜像</h3> <p><code>$ docker image ls</code></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># docker image ls</span>
REPOSITORY           TAG                 IMAGE ID            CREATED             SIZE
redis                latest              5f515359c7f8        <span class="token number">5</span> days ago          <span class="token number">183</span> MB
nginx                latest              05a60462f8ba        <span class="token number">5</span> days ago          <span class="token number">181</span> MB
mongo                <span class="token number">3.2</span>                 fe9198c04d62        <span class="token number">5</span> days ago          <span class="token number">342</span> MB
<span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>               <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>              00285df0df87        <span class="token number">5</span> days ago          <span class="token number">342</span> MB
ubuntu               <span class="token number">18.04</span>               f753707788c5        <span class="token number">4</span> weeks ago         <span class="token number">127</span> MB
ubuntu               latest              f753707788c5        <span class="token number">4</span> weeks ago         <span class="token number">127</span> MB
</code></pre></div><p>列表包含了 <code>仓库名</code>、<code>标签</code>、<code>镜像ID</code>、<code>创建时间</code>以及<code>所占用的空间</code>。<strong>镜像 ID</strong> 则是镜像的唯一标识，一个镜像可以对应多个<strong>标签</strong></p> <h3 id="虚悬镜像"><a href="#虚悬镜像" class="header-anchor">#</a> 虚悬镜像</h3> <p><code>docker image ls -f dangling=true</code></p> <p>一般来说，虚悬镜像已经失去了存在的价值，是可以随意删除的，可以用上面的命令删除。</p> <h3 id="镜像构建最小化"><a href="#镜像构建最小化" class="header-anchor">#</a> 镜像构建最小化</h3> <ol><li>减少镜像层</li></ol> <p><code>错误示例</code></p> <div class="language-Dockerfile extra-class"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">FROM</span> ubuntu</span>
<span class="token instruction"><span class="token keyword">RUN</span> apt-get update</span>
<span class="token instruction"><span class="token keyword">RUN</span> apt-get install vim</span>
</code></pre></div><p><code>正确示例</code></p> <div class="language-Dockerfile extra-class"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">FROM</span> ubuntu</span>
<span class="token instruction"><span class="token keyword">RUN</span> apt-get update &amp;&amp; apt-get install vim</span>
</code></pre></div><p>2.删掉容器中所有不必要的东西</p> <p>3.基于Alpine的较小基础镜像</p> <h2 id="网络"><a href="#网络" class="header-anchor">#</a> 网络</h2> <h3 id="bridge网络模式"><a href="#bridge网络模式" class="header-anchor">#</a> Bridge网络模式</h3> <h3 id="host网络模式"><a href="#host网络模式" class="header-anchor">#</a> Host网络模式</h3> <h3 id="container网络模式"><a href="#container网络模式" class="header-anchor">#</a> Container网络模式</h3> <h3 id="none网络模式"><a href="#none网络模式" class="header-anchor">#</a> None网络模式</h3> <h2 id="dockerfile"><a href="#dockerfile" class="header-anchor">#</a> Dockerfile</h2> <h3 id="概述"><a href="#概述" class="header-anchor">#</a> 概述</h3> <p>镜像的定制实际上就是定制每一层所添加的配置、文件。如果我们可以把每一层修改、安装、构建、操作的命令都写入一个脚本，用这个脚本来构建、定制镜像，这个脚本就是 Dockerfile。</p> <p>Dockerfile 是一个文本文件，其内包含了一条条的<strong>指令(Instruction)</strong>，每一条指令构建一层，因此每一条指令的内容，就是描述该层应当如何构建。</p> <div class="language-dockerfile extra-class"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">FROM</span> nginx</span>
<span class="token instruction"><span class="token keyword">RUN</span> echo <span class="token string">'&lt;h1&gt;Hello, Docker!&lt;/h1&gt;'</span> &gt; /usr/share/nginx/html/index.html</span>
</code></pre></div><h3 id="from"><a href="#from" class="header-anchor">#</a> FROM</h3> <div class="language-dockerfile extra-class"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">FROM</span> scratch</span>
</code></pre></div><h3 id="build"><a href="#build" class="header-anchor">#</a> BUILD</h3> <p><code>build</code>指令用来构建镜像</p> <p>格式：</p> <p><code>docker build [选项] &lt;上下文路径/URL/-&gt;</code></p> <p>在 <code>Dockerfile</code> 文件所在目录执行：</p> <p><code>$ docker build -t nginx:v3 .</code></p> <h3 id="copy"><a href="#copy" class="header-anchor">#</a> COPY</h3> <p>COPY有2种格式：</p> <ul><li><code>COPY [--chown=&lt;user&gt;:&lt;group&gt;] &lt;src&gt;... &lt;dest&gt;</code></li> <li><code>COPY [--chown=&lt;user&gt;:&lt;group&gt;] [&quot;&lt;src&gt;&quot;,... &quot;&lt;dest&gt;&quot;]</code></li></ul> <p><code>COPY</code>指令将从构建上下文目录中<code>&lt;源路径&gt;</code>的文件/目录复制到新的一层的镜像内的<code>&lt;目标路径&gt;</code>位置</p> <div class="language-Dockerfile extra-class"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">COPY</span> package.json /usr/src/app/</span>
</code></pre></div><h3 id="add"><a href="#add" class="header-anchor">#</a> ADD</h3> <p><code>ADD</code>指令和<code>COPY</code>的格式和性质基本一致，但是在<code>COPY</code>基础上增加了一些功能。</p> <ol><li><code>ADD</code>指令支持使用URL作为<code>&lt;源路径&gt;</code>参数</li></ol> <div class="language-Dockerfile extra-class"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">ADD</span> http://foo.com/bar.go /tmp/</span>
</code></pre></div><ol start="2"><li><code>ADD</code>指令能够自动解压缩文件</li></ol> <div class="language-Dockerfile extra-class"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">ADD</span> foo.tar.gz /tmp/</span>
</code></pre></div><p>PS: <code>COPY</code>和<code>ADD</code>指令中选择的时候，可以遵循这样的原则，所有的文件复制均使用<code>COPY</code>指令，仅在需要自动解压缩的场合使用<code>ADD</code>。</p> <h3 id="run"><a href="#run" class="header-anchor">#</a> RUN</h3> <p><code>RUN</code>指令执行命令并创建新的镜像层，通常用于安装软件包。有2种运行命令的格式</p> <ul><li>shell格式：<code>RUN &lt;命令&gt;</code>，就像直接在命令行中输入的命令一样。</li></ul> <div class="language-Dockerfile extra-class"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">RUN</span> echo hello world</span>
</code></pre></div><ul><li>exec格式：<code>RUN [&quot;可执行文件&quot;, &quot;参数1&quot;, &quot;参数2&quot;]</code>，这更像是函数调用中的格式。</li></ul> <div class="language-Dockerfile extra-class"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">RUN</span> [<span class="token string">&quot;echo&quot;</span>, <span class="token string">&quot;hello world&quot;</span>]</span>
</code></pre></div><p>Dockerfile中每一个指令都会建立一层，<code>RUN</code>也不例外。每一个<code>RUN</code>的行为，就和刚才我们手工建立镜像的过程一样：新建立一层，在其上执行这些命令，执行结束后，commit这一层的修改，构成新的镜像。</p> <h3 id="cmd"><a href="#cmd" class="header-anchor">#</a> CMD</h3> <p><code>CMD</code>指令的格式和<code>RUN</code>相似，也是两种格式：</p> <ul><li>shell格式：<code>CMD &lt;命令&gt;</code></li> <li>exec格式：<code>CMD [&quot;可执行文件&quot;, &quot;参数1&quot;, &quot;参数2&quot;...]</code></li> <li>参数列表格式：<code>CMD [&quot;参数1&quot;, &quot;参数2&quot;...]</code>，在<code>ENTRYPOINT</code>指令后，用<code>CMD</code>指定具体的参数。</li></ul> <p><code>CMD</code>指令指定容器的默认执行命令，此命令会在容器启动且<code>docker run</code>没有指定其他命令时运行，如果指定了命令则会被替换</p> <div class="language-Dockerfile extra-class"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">FROM</span> busybox</span>
<span class="token instruction"><span class="token keyword">CMD</span> [<span class="token string">&quot;echo&quot;</span>, <span class="token string">&quot;hello world&quot;</span>]</span>
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>➜  /Users/pdd docker run test:v1
hello world

➜  /Users/pdd docker run -it test:v1 <span class="token function">sh</span>
/ <span class="token comment">#</span>
</code></pre></div><h3 id="entrypoint"><a href="#entrypoint" class="header-anchor">#</a> ENTRYPOINT</h3> <p><code>ENTRYPOINT</code>的目的和<code>CMD</code>一样，都是在指定容器启动程序及参数。其指令的格式和<code>RUN</code>指令格式一样，分为shell格式和exec格式。</p> <div class="language-Dockerfile extra-class"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">FROM</span> busybox</span>
<span class="token instruction"><span class="token keyword">ENTRYPOINT</span> [<span class="token string">&quot;echo&quot;</span>, <span class="token string">&quot;hello world&quot;</span>]</span>
<span class="token instruction"><span class="token keyword">CMD</span> [<span class="token string">&quot; --- pdd&quot;</span>]</span>
</code></pre></div><p>当指定了<code>ENTRYPOINT</code>后，<code>CMD</code>的含义就发生了改变，不再是直接的运行其命令，而是将<code>CMD</code>的内容作为参数传给<code>ENTRYPOINT</code>指令</p> <div class="language-shell extra-class"><pre class="language-shell"><code>➜  /Users/pdd docker run test:v2
hello world  --- pdd
</code></pre></div><p><code>ENTRYPOINT</code>在运行时也可以替代，不过比<code>CMD</code>要略显繁琐，需要通过 <code>docker run</code>的参数<code>--entrypoint</code>来指定。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>➜  /Users/pdd docker run -it --entrypoint <span class="token string">&quot;sh&quot;</span> test:v2
/ <span class="token comment">#</span>
</code></pre></div><h3 id="env"><a href="#env" class="header-anchor">#</a> ENV</h3> <p>格式有两种：</p> <ul><li><code>ENV &lt;key&gt; &lt;value&gt;</code></li> <li><code>ENV &lt;key1&gt;=&lt;value1&gt; &lt;key2&gt;=&lt;value2&gt;...</code></li></ul> <p>这个指令设置环境变量，无论是后面的其它指令，如 <code>RUN</code>，还是运行时的应用，都可以直接使用这里定义的环境变量。</p> <div class="language-Dockerfie extra-class"><pre class="language-text"><code>ENV VERSION=1.0 DEBUG=on \
    NAME=&quot;Happy Feet&quot;
</code></pre></div><h3 id="arg"><a href="#arg" class="header-anchor">#</a> ARG</h3> <p>格式：<code>ARG &lt;参数名&gt;[=&lt;默认值&gt;]</code></p> <p>构建参数和 <code>ENV</code> 的效果一样，都是设置环境变量。所不同的是，<code>ARG</code> 所设置的构建环境的环境变量，在将来容器运行时是不会存在这些环境变量的。但是不要因此就使用 <code>ARG</code> 保存密码之类的信息，因为 <code>docker history</code> 还是可以看到所有值的。</p> <h3 id="volume"><a href="#volume" class="header-anchor">#</a> VOLUME</h3> <p><code>docker run --name webserver -d -p 80:80 -v /data/logs/nginx/:/var/log/nginx nginx</code></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token string">&quot;Mounts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token string">&quot;Type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;bind&quot;</span>,
                <span class="token string">&quot;Source&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/data/logs/nginx&quot;</span>,
                <span class="token string">&quot;Destination&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/var/log/nginx&quot;</span>,
                <span class="token string">&quot;Mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
                <span class="token string">&quot;RW&quot;</span><span class="token builtin class-name">:</span> true,
                <span class="token string">&quot;Propagation&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;rprivate&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
</code></pre></div><p><code>docker run --name webserver_v2 -d -p 8080:80 -v nginx:/var/log/nginx nginx</code></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token string">&quot;Mounts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token string">&quot;Type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;volume&quot;</span>,
                <span class="token string">&quot;Name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;nginx&quot;</span>,
                <span class="token string">&quot;Source&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/var/lib/docker/volumes/nginx/_data&quot;</span>,
                <span class="token string">&quot;Destination&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/var/log/nginx&quot;</span>,
                <span class="token string">&quot;Driver&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;local&quot;</span>,
                <span class="token string">&quot;Mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;z&quot;</span>,
                <span class="token string">&quot;RW&quot;</span><span class="token builtin class-name">:</span> true,
                <span class="token string">&quot;Propagation&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
</code></pre></div><h3 id="expose"><a href="#expose" class="header-anchor">#</a> EXPOSE</h3> <p><code>EXPOSE</code> 指令是声明容器运行时提供的服务端口</p> <p><code>docker run -p &lt;宿主端口&gt;:&lt;容器端口&gt;</code>，如果宿主端口不指定则服务器随机分配端口</p> <div class="language-shell extra-class"><pre class="language-shell"><code>➜  ~ docker run --name myapp-v1 -d -p <span class="token number">80</span> myhttp:v1
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>➜  ~ docker <span class="token function">ps</span>
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                   NAMES
3070486b1d6c        myhttp:v1           <span class="token string">&quot;python httpserver1.…&quot;</span>   <span class="token number">54</span> minutes ago      Up <span class="token number">54</span> minutes       <span class="token number">0.0</span>.0.0:32768-<span class="token operator">&gt;</span><span class="token number">80</span>/tcp   myapp-v1
</code></pre></div><h4 id="expose和publish-run-p-的区别"><a href="#expose和publish-run-p-的区别" class="header-anchor">#</a> EXPOSE和PUBLISH（run -p）的区别</h4> <ul><li><p>既没有在Dockerfile里Expose, 也没有run -p
启动在这个container里的服务既不能被host主机和外网访问，也不能被link的container访问，只能在此容器内部使用</p></li> <li><p>只在Dockerfile里Expose了这个端口
启动在这个container里的服务不能被docker外部世界（host和其他主机）访问，但是可以通过container link，被其他link的container访问到</p></li> <li><p>同时在Dockerfile里Expose，又run -p
启动的这个cotnainer既可以被docker外部世界访问，也可以被link的container访问</p></li> <li><p>只有run -p
docker做了特殊的隐式转换，等价于第一种情况，既可以被外部世界访问，也可以被link的container访问到（真对这种情况，原因是docker认为，既然你都要把port open到外部世界了，等价于其他的container肯定也能访问，所以docker做了自动的Expose</p></li></ul> <h3 id="workdir"><a href="#workdir" class="header-anchor">#</a> WORKDIR</h3> <p>指定<code>dockerfile</code>的工作目录位置</p> <h3 id="user"><a href="#user" class="header-anchor">#</a> USER</h3> <p>指定当前用户</p> <h3 id="onbuild"><a href="#onbuild" class="header-anchor">#</a> ONBUILD</h3> <p>格式：<code>ONBUILD &lt;其它指令&gt;</code>。</p> <p><code>ONBUILD</code> 是一个特殊的指令，它后面跟的是其它指令，比如 <code>RUN</code>, <code>COPY</code> 等，而这些指令，在当前镜像构建时并不会被执行。只有当以当前镜像为基础镜像，去构建下一级镜像的时候才会被执行。</p> <p>基础镜像</p> <div class="language-dockerfile extra-class"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">FROM</span> node:slim</span>
<span class="token instruction"><span class="token keyword">RUN</span> mkdir /app</span>
<span class="token instruction"><span class="token keyword">WORKDIR</span> /app</span>
<span class="token instruction"><span class="token keyword">ONBUILD</span> <span class="token keyword">COPY</span> ./package.json /app</span>
<span class="token instruction"><span class="token keyword">ONBUILD</span> <span class="token keyword">RUN</span> [ <span class="token string">&quot;npm&quot;</span>, <span class="token string">&quot;install&quot;</span> ]</span>
<span class="token instruction"><span class="token keyword">ONBUILD</span> <span class="token keyword">COPY</span> . /app/</span>
<span class="token instruction"><span class="token keyword">CMD</span> [ <span class="token string">&quot;npm&quot;</span>, <span class="token string">&quot;start&quot;</span> ]</span>
</code></pre></div><p>子镜像</p> <div class="language-dockerfile extra-class"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">FROM</span> my-node</span>
</code></pre></div><h3 id="多阶段构建"><a href="#多阶段构建" class="header-anchor">#</a> 多阶段构建</h3> <p>允许一个Dockerfile 中出现多个 <code>FROM</code> 指令。</p> <h2 id="容器"><a href="#容器" class="header-anchor">#</a> 容器</h2> <h3 id="启动"><a href="#启动" class="header-anchor">#</a> 启动</h3> <p><code>$ docker run ubuntu:18.04 /bin/echo 'Hello world</code></p> <p><code>$ docker run --name webserver -d -p 80:80 nginx</code></p> <h3 id="日志"><a href="#日志" class="header-anchor">#</a> 日志</h3> <p><code>docker container logs [container ID or NAMES]</code></p> <h3 id="终止"><a href="#终止" class="header-anchor">#</a> 终止</h3> <p><code>docker container stop|start|restart</code></p> <p>终止状态的容器可以用 <code>docker container ls -a</code> 命令看到。</p> <h3 id="进入"><a href="#进入" class="header-anchor">#</a> 进入</h3> <p><code>$ docker exec -it webserver bash</code></p> <h3 id="删除"><a href="#删除" class="header-anchor">#</a> 删除</h3> <p>删除一个处于终止状态的容器。</p> <p><code>$ docker container rm</code></p> <p>删除一个处于运行状态的容器。</p> <p><code>$ docker contain rm -f</code></p> <p>清理掉所有处于终止状态的容器</p> <p><code>$ docker container prune</code></p> <h2 id="sdk"><a href="#sdk" class="header-anchor">#</a> SDK</h2> <h3 id="go-sdk"><a href="#go-sdk" class="header-anchor">#</a> Go SDK</h3> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">go</span> get github<span class="token punctuation">.</span>com<span class="token operator">/</span>docker<span class="token operator">/</span>docker<span class="token operator">/</span>client
</code></pre></div><h4 id="获取容器信息"><a href="#获取容器信息" class="header-anchor">#</a> 获取容器信息</h4> <p><code>docker ps -a --filter=&quot;name=frontend&quot;</code></p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
  <span class="token string">&quot;context&quot;</span>
  <span class="token string">&quot;fmt&quot;</span>
  <span class="token string">&quot;github.com/docker/docker/api/types&quot;</span>
  <span class="token string">&quot;github.com/docker/docker/api/types/filters&quot;</span>
  <span class="token string">&quot;github.com/docker/docker/client&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  cli<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">NewClientWithOpts</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span>FromEnv<span class="token punctuation">,</span> client<span class="token punctuation">.</span><span class="token function">WithAPIVersionNegotiation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;docker api error: %s&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 关闭docker api</span>
  <span class="token keyword">defer</span> cli<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// docker ps -a --filter &quot;name=frontend&quot;</span>
  customFilter <span class="token operator">:=</span> filters<span class="token punctuation">.</span><span class="token function">NewArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  customFilter<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;lcm_frontend_pdd&quot;</span><span class="token punctuation">)</span>
  containers<span class="token punctuation">,</span> err <span class="token operator">:=</span> cli<span class="token punctuation">.</span><span class="token function">ContainerList</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> types<span class="token punctuation">.</span>ContainerListOptions<span class="token punctuation">{</span>All<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> Filters<span class="token punctuation">:</span> customFilter<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;docker list error: %s&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>containers<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;containers not exist&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> container <span class="token operator">:=</span> <span class="token keyword">range</span> containers <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;ID: %s\n&quot;</span><span class="token punctuation">,</span> container<span class="token punctuation">.</span>ID<span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Image: %s\n&quot;</span><span class="token punctuation">,</span> container<span class="token punctuation">.</span>Image<span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;State: %s\n&quot;</span><span class="token punctuation">,</span> container<span class="token punctuation">.</span>State<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="获取本地镜像信息"><a href="#获取本地镜像信息" class="header-anchor">#</a> 获取本地镜像信息</h4> <p><code>docker images --filter=reference='172.16.81.200:443/library/frontend'</code></p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
  <span class="token string">&quot;context&quot;</span>
  <span class="token string">&quot;fmt&quot;</span>
  <span class="token string">&quot;github.com/docker/docker/api/types&quot;</span>
  <span class="token string">&quot;github.com/docker/docker/api/types/filters&quot;</span>
  <span class="token string">&quot;github.com/docker/docker/client&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  cli<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">NewClientWithOpts</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span>FromEnv<span class="token punctuation">,</span> client<span class="token punctuation">.</span><span class="token function">WithAPIVersionNegotiation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;docker api error: %s&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 关闭docker api</span>
  <span class="token keyword">defer</span> cli<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// docker images --filter=reference='172.16.81.200:443/library/frontend'</span>
  customFilter <span class="token operator">:=</span> filters<span class="token punctuation">.</span><span class="token function">NewArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  customFilter<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;reference&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;172.16.81.200:443/library/frontend&quot;</span><span class="token punctuation">)</span>
  images<span class="token punctuation">,</span> err <span class="token operator">:=</span> cli<span class="token punctuation">.</span><span class="token function">ImageList</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> types<span class="token punctuation">.</span>ImageListOptions<span class="token punctuation">{</span>All<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> Filters<span class="token punctuation">:</span> customFilter<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;docker image error: %s&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>images<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;images not exist&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> image <span class="token operator">:=</span> <span class="token keyword">range</span> images <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;ID\n: %s&quot;</span><span class="token punctuation">,</span> image<span class="token punctuation">.</span>ID<span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Digest: %s\n&quot;</span><span class="token punctuation">,</span> image<span class="token punctuation">.</span>RepoDigests<span class="token punctuation">)</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Tag: %s\n&quot;</span><span class="token punctuation">,</span> image<span class="token punctuation">.</span>RepoTags<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.88086388.js" defer></script><script src="/blog/assets/js/2.49a236d9.js" defer></script><script src="/blog/assets/js/23.7b46bea8.js" defer></script>
  </body>
</html>
